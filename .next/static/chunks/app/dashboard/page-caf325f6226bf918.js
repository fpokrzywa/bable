(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{56:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>sl});var a=t(5155),r=t(2115),n=t(5695),i=t(4477);let l=(0,i.createServerReference)("400a9de865773ec8101e92f4af210e01c02aafc301",i.callServer,void 0,i.findSourceMapURL,"generateWidgetFromQuery"),o=(0,i.createServerReference)("40d5932978aaddd7876de3066f7770b62b048f4307",i.callServer,void 0,i.findSourceMapURL,"agentSpecificWidget"),c=(0,i.createServerReference)("4070ea44827f25b8f02db110d8319d7a4329aaa7d7",i.callServer,void 0,i.findSourceMapURL,"saveQueryWithVoiceText"),d=(0,i.createServerReference)("406a0afe838fa599f603eb18962fef53a81d2dfab3",i.callServer,void 0,i.findSourceMapURL,"generateOverviewSummary");var m=t(31),u=t(5791),p=t(5939),h=t.n(p),x=t(6695),f=t(285),g=t(6102),v=t(3503),j=t(8224),y=t(8098),w=t(6438),N=t(5318),b=t(792);function k(e){let{data:s}=e;return(0,a.jsx)("div",{className:"text-sm @[400px]:text-base h-full",children:"string"==typeof s?(0,a.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:(0,a.jsx)(b.oz,{children:s})}):(0,a.jsx)("pre",{className:"whitespace-pre-wrap break-all",children:JSON.stringify(s,null,2)})})}let C=(0,i.createServerReference)("40d3e570bed37cc4145644b4db3b6d162aab6cec55",i.callServer,void 0,i.findSourceMapURL,"contextAwareWidgetChat");var S=t(2543),E=t(5943),A=t(9434),R=t(4165),_=t(2177),I=t(221),T=t(5594),F=t(7759),L=t(2523),M=t(8539);let W=T.Ik({short_description:T.Yj().min(1,"Short description is required"),priority:T.Yj().optional(),state:T.Yj().optional(),assigned_to:T.Yj().optional(),description:T.Yj().optional()}),D={incident:W,problem:T.Ik({short_description:T.Yj().min(1,"Short description is required"),description:T.Yj().optional(),workaround:T.Yj().optional(),cause:T.Yj().optional()}),change:T.Ik({short_description:T.Yj().min(1,"Short description is required"),type:T.Yj().optional(),state:T.Yj().optional(),assigned_to:T.Yj().optional(),justification:T.Yj().optional(),implementation_plan:T.Yj().optional()})},U={incident:[{name:"short_description",label:"Short Description",type:"input"},{name:"priority",label:"Priority",type:"input"},{name:"state",label:"State",type:"input"},{name:"assigned_to",label:"Assigned To",type:"input"},{name:"description",label:"Description",type:"textarea"}],problem:[{name:"short_description",label:"Short Description",type:"input"},{name:"description",label:"Description",type:"textarea"},{name:"workaround",label:"Workaround",type:"textarea"},{name:"cause",label:"Cause",type:"textarea"}],change:[{name:"short_description",label:"Short Description",type:"input"},{name:"type",label:"Type",type:"input"},{name:"state",label:"State",type:"input"},{name:"assigned_to",label:"Assigned To",type:"input"},{name:"justification",label:"Justification",type:"textarea"},{name:"implementation_plan",label:"Implementation Plan",type:"textarea"}]};function z(e){let{type:s,entity:t,onSubmit:r}=e,n=(0,_.mN)({resolver:(0,I.u)(D[s]),defaultValues:t}),i=U[s];return(0,a.jsx)(F.lV,{...n,children:(0,a.jsxs)("form",{onSubmit:n.handleSubmit(r),className:"space-y-4",children:[i.map(e=>(0,a.jsx)(F.zB,{control:n.control,name:e.name,render:s=>{let{field:t}=s;return(0,a.jsxs)(F.eI,{children:[(0,a.jsx)(F.lR,{children:e.label}),(0,a.jsx)(F.MJ,{children:"textarea"===e.type?(0,a.jsx)(M.T,{...t}):(0,a.jsx)(L.p,{...t})}),(0,a.jsx)(F.C5,{})]})}},e.name)),(0,a.jsx)(R.HM,{asChild:!0,children:(0,a.jsx)(f.$,{type:"submit",children:"Save Changes"})})]})})}let O={incident:{title:"Incident",fields:{short_description:"Short Description",state:"State",priority:"Priority",assigned_to:"Assigned To",description:"Description"}},problem:{title:"Problem",fields:{short_description:"Short Description",description:"Description",workaround:"Workaround",cause:"Cause"}},change:{title:"Change",fields:{short_description:"Short Description",type:"Type",state:"State",assigned_to:"Assigned To",justification:"Justification",implementation_plan:"Implementation Plan"}}};function P(e){let{widgetId:s,type:t,entities:n,onTextSelect:i,updateEntity:l,onEntitySelectForChat:o}=e,[c,d]=(0,r.useState)(null),[m,u]=(0,r.useState)(null),p=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=()=>{var e;let s=null==(e=window.getSelection())?void 0:e.toString().trim();s&&i(s)},s=p.current;return null==s||s.addEventListener("mouseup",e),()=>{null==s||s.removeEventListener("mouseup",e)}},[i]);let h=e=>{d(e)},{title:x,fields:g}=O[t];return(0,a.jsxs)("div",{ref:p,className:"relative h-full overflow-hidden text-sm @[400px]:text-base",children:[(0,a.jsx)("div",{className:(0,A.cn)("transition-transform duration-300 ease-in-out h-full overflow-y-auto no-scrollbar",{"-translate-x-full":c}),children:n.map(e=>(0,a.jsxs)("div",{className:"mb-4 p-2 rounded-md hover:bg-accent/50",children:[(0,a.jsx)("p",{className:"font-medium cursor-pointer",onClick:()=>o(e),children:e.number}),(0,a.jsx)("p",{className:"text-muted-foreground cursor-pointer text-xs @[400px]:text-sm",onClick:()=>h(e),children:e.short_description})]},e.number))}),(0,a.jsx)("div",{className:(0,A.cn)("absolute top-0 right-0 h-full w-full bg-card p-4 transition-transform duration-300 ease-in-out","flex flex-col",c?"translate-x-0":"translate-x-full"),children:c&&(0,a.jsxs)("div",{className:"flex-1 min-h-0 overflow-auto no-scrollbar",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)(f.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>{d(null)},children:(0,a.jsx)(S.A,{size:18})}),(0,a.jsx)("h3",{className:"font-semibold",children:c.number}),(0,a.jsxs)(R.lG,{onOpenChange:e=>!e&&u(null),children:[(0,a.jsx)(R.zM,{asChild:!0,children:(0,a.jsxs)(f.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>u(c),children:[(0,a.jsx)(E.A,{size:16}),(0,a.jsx)("span",{className:"sr-only",children:"Edit"})]})}),(0,a.jsxs)(R.Cf,{children:[(0,a.jsx)(R.c7,{children:(0,a.jsxs)(R.L3,{children:["Edit ",x," ",null==m?void 0:m.number]})}),m&&(0,a.jsx)(z,{type:t,entity:m,onSubmit:e=>{m&&(l(s,m.number,e),u(null),c&&c.number===m.number&&d({...c,...e}))}})]})]})]}),(0,a.jsx)("div",{className:"space-y-4",children:Object.entries(g).map(e=>{let[s,t]=e,r=c[s];if(null==r||""===r)return null;let n="object"==typeof r&&r.hasOwnProperty("value")?r.value:r;return(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-muted-foreground",children:t}),(0,a.jsx)("p",{className:"whitespace-pre-wrap",children:n})]},s)})})]})})]})}var B=t(5546),q=t(1721),J=t(172),$=t(3672),G=t(1394);function Z(e){let{messages:s,loading:t,onSubmit:n,agentType:i,onClose:l}=e,[o,c]=(0,r.useState)(""),d=(0,r.useRef)(null),m=(0,r.useRef)(null);return(0,r.useEffect)(()=>{d.current&&(d.current.scrollTop=d.current.scrollHeight)},[s]),(0,r.useEffect)(()=>{if(!t){var e;null==(e=m.current)||e.focus()}},[t]),(0,a.jsxs)("div",{className:"h-full flex flex-col bg-background/50",children:[(0,a.jsxs)("div",{className:"p-3 flex items-center justify-between",children:[(0,a.jsxs)("h4",{className:"font-semibold text-sm",children:["Chat with ",i]}),(0,a.jsx)(f.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:l,children:(0,a.jsx)(B.A,{size:18})})]}),(0,a.jsx)("div",{className:"flex-1 p-4 overflow-auto no-scrollbar",ref:d,children:(0,a.jsxs)("div",{className:"space-y-4",children:[s.map((e,s)=>(0,a.jsxs)("div",{className:(0,A.cn)("flex items-start gap-3","user"===e.role?"justify-end":"justify-start"),children:["model"===e.role&&(0,a.jsx)(G.eu,{className:"w-8 h-8 border",children:(0,a.jsx)(G.q5,{children:(0,a.jsx)(v.A,{size:18})})}),(0,a.jsx)("div",{className:(0,A.cn)("rounded-lg px-3 py-2 max-w-[80%] text-sm","user"===e.role?"bg-primary text-primary-foreground":"bg-muted"),children:(0,a.jsx)("p",{className:"whitespace-pre-wrap",children:e.content})}),"user"===e.role&&(0,a.jsx)(G.eu,{className:"w-8 h-8 border",children:(0,a.jsx)(G.q5,{children:(0,a.jsx)(q.A,{size:18})})})]},s)),t&&(0,a.jsxs)("div",{className:"flex items-start gap-3 justify-start",children:[(0,a.jsx)(G.eu,{className:"w-8 h-8 border",children:(0,a.jsx)(G.q5,{children:(0,a.jsx)(v.A,{size:18})})}),(0,a.jsx)("div",{className:"rounded-lg px-3 py-2 max-w-[80%] text-sm bg-muted flex items-center",children:(0,a.jsx)(J.A,{className:"animate-spin h-5 w-5"})})]})]})}),(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),o.trim()&&(n(o),c(""))},className:"flex w-full items-center gap-2",children:[(0,a.jsx)(L.p,{ref:m,placeholder:"Your message...",value:o,onChange:e=>c(e.target.value),disabled:t,className:"text-xs"}),(0,a.jsx)(f.$,{type:"submit",size:"icon",disabled:t||!o.trim(),children:t?(0,a.jsx)(J.A,{className:"animate-spin",size:16}):(0,a.jsx)($.A,{size:16})})]})})]})}var V=t(7906);function Y(e){let{widget:s,removeWidget:t,updateEntity:n,bringToFront:i,toggleMinimizeWidget:l,toggleFavoriteWidget:o}=e,[c,d]=(0,r.useState)([]),[m,u]=(0,r.useState)("generic"===s.type),[p,h]=(0,r.useState)(!1),b=(0,r.useRef)(null),[S,E]=(0,r.useState)(375),[R,_]=(0,r.useState)(!1),[I,T]=(0,r.useState)(null),F=(0,V.a)();(0,r.useEffect)(()=>{m&&b.current&&E(b.current.offsetWidth/2)},[m]);let L=(0,r.useCallback)(e=>{if(R&&b.current){let s=b.current.getBoundingClientRect().right-e.clientX,t=b.current.offsetWidth;s>200&&s<t-250&&E(s)}},[R]),M=(0,r.useCallback)(()=>{_(!1)},[]);(0,r.useEffect)(()=>(R?(window.addEventListener("mousemove",L),window.addEventListener("mouseup",M)):(window.removeEventListener("mousemove",L),window.removeEventListener("mouseup",M)),()=>{window.removeEventListener("mousemove",L),window.removeEventListener("mouseup",M)}),[R,L,M]);let W=()=>{m||i(s.id,!0),u(e=>(!1==!e&&T(null),!e))},D=async e=>{if(!e.trim())return;h(!0);let t=[...c,{role:"user",content:e}];d(t),m||W();try{let a=await C({widgetType:s.type,widgetData:s.data,userQuery:e,selectedEntityData:null!=I?I:void 0,chatHistory:t.slice(0,-1).map(e=>({role:"user"===e.role?"user":"model",content:e.content}))}),r={role:"model",content:a.suggestedActions.join("\n")||"I don't have any specific suggestions for that."};d(e=>[...e,r])}catch(s){console.error("Context-aware chat failed:",s);let e={role:"model",content:"Sorry, I encountered an error."};d(s=>[...s,e])}finally{h(!1)}},U=e=>{e&&(m||W(),d(s=>[...s,{role:"model",content:'What would you like to ask about "'.concat(e,'"?')}]))},z=e=>{T(e),m||u(!0),d(t=>[...t,{role:"model",content:"Now focusing on ".concat(s.type," ").concat(e.number,". What would you like to know?")}])};return(0,a.jsxs)(x.Zp,{className:(0,A.cn)("w-full h-full flex flex-col bg-card/80 backdrop-blur-sm overflow-hidden",!F&&"resizable-widget"),ref:b,style:{width:F?"100%":s.width?s.width:m?K:H,height:F?"auto":s.height},children:[(0,a.jsx)("div",{className:(0,A.cn)(!F&&"drag-handle cursor-move"),onDoubleClick:()=>l(s.id),children:(0,a.jsxs)(x.aR,{className:"flex flex-row items-start justify-between p-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(x.ZB,{className:"text-lg @[400px]:text-xl @[500px]:text-2xl",children:s.query}),(0,a.jsx)(g.Bc,{children:(0,a.jsxs)(g.m_,{children:[(0,a.jsx)(g.k$,{asChild:!0,children:(0,a.jsxs)(x.BT,{className:"flex items-center gap-1.5 cursor-help mt-1 text-xs @[400px]:text-sm",children:[(0,a.jsx)(v.A,{size:14,className:"text-primary"}),s.agent.agentType]})}),(0,a.jsx)(g.ZI,{children:(0,a.jsx)("p",{children:s.agent.agentBehavior})})]})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(f.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:W,children:[(0,a.jsx)(j.A,{size:18,className:m?"text-primary":""}),(0,a.jsx)("span",{className:"sr-only",children:"Toggle chat"})]}),(0,a.jsxs)(f.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>o(s.id),children:[(0,a.jsx)(y.A,{size:18,className:s.isFavorited?"fill-primary text-primary":""}),(0,a.jsx)("span",{className:"sr-only",children:"Favorite widget"})]}),(0,a.jsxs)(f.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>l(s.id),children:[(0,a.jsx)(w.A,{size:18}),(0,a.jsx)("span",{className:"sr-only",children:"Minimize widget"})]}),(0,a.jsxs)(f.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>t(s.id),children:[(0,a.jsx)(N.A,{size:18}),(0,a.jsx)("span",{className:"sr-only",children:"Close widget"})]})]})]})}),(0,a.jsx)(x.Wu,{className:"flex-1 min-h-0 relative p-0",children:(0,a.jsxs)("div",{className:(0,A.cn)("flex h-full",R?"cursor-col-resize select-none":""),children:[(0,a.jsx)("div",{className:"h-full flex-1 overflow-auto no-scrollbar",style:{width:m?"calc(100% - ".concat(S,"px)"):"100%"},children:(0,a.jsx)("div",{className:"p-4 h-full",children:(()=>{switch(s.type){case"incident":case"problem":case"change":if(!Array.isArray(s.data))return(0,a.jsx)(k,{data:"Data is not in the correct format."});let e=s.data.map(e=>Object.entries(e).reduce((e,s)=>{let[t,a]=s;return e[t]="object"==typeof a&&null!==a&&"value"in a?a.value:a,e},{}));return(0,a.jsx)(P,{widgetId:s.id,type:s.type,entities:e,onTextSelect:U,updateEntity:n,onEntitySelectForChat:z});default:return(0,a.jsx)(k,{data:s.data})}})()})}),m&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-px h-full cursor-col-resize bg-border/50 hover:bg-border transition-colors",onMouseDown:()=>_(!0)}),(0,a.jsx)("div",{style:{width:"".concat(S,"px")},children:(0,a.jsx)(Z,{messages:c,loading:p,onSubmit:D,agentType:s.agent.agentType,onClose:W})})]})]})})]})}let H=450,K=750;function X(e){let{widgets:s,removeWidget:t,updateEntity:n,bringToFront:i,toggleMinimizeWidget:l,toggleFavoriteWidget:o,updateWidgetPosition:c,updateWidgetDimensions:d,sidebarState:m,sidebarRef:u,chatInputRef:p,setIsDragging:x}=e,f=(0,r.useRef)(null),[g,v]=(0,r.useState)({}),j=(0,r.useRef)(null),y=(0,r.useRef)(new Map);s.forEach(e=>{y.current.has(e.id)||y.current.set(e.id,(0,r.createRef)())});let w=(0,r.useCallback)(()=>{let e=f.current;if(!e)return;let t=e.offsetWidth,a=e.offsetHeight,r={};s.forEach(e=>{var s;let n=null==(s=y.current.get(e.id))?void 0:s.current;if(n){let s=n.offsetWidth,i=n.offsetHeight;r[e.id]={left:0,top:0,right:t-s,bottom:a-i}}}),v(r)},[s]);(0,r.useEffect)(()=>{let e=f.current;if(!e)return;let t=new ResizeObserver(w);return t.observe(e),u.current&&t.observe(u.current),p.current&&t.observe(p.current),s.forEach(e=>{var s;let a=null==(s=y.current.get(e.id))?void 0:s.current;a&&t.observe(a)}),j.current=t,()=>{t.disconnect()}},[m,u,p,s,w]);let N=(e,s)=>{c(e,s.x,s.y),x(!1)},b=(e,s)=>{d(e,s.offsetWidth,s.offsetHeight)};return 0===s.length?null:(0,a.jsx)("div",{className:"relative w-full h-full",ref:f,children:s.map(e=>{var s,r;let c=y.current.get(e.id);return(0,a.jsx)(h(),{nodeRef:c,handle:".drag-handle",onStart:()=>{i(e.id),x(!0)},onStop:(s,t)=>N(e.id,t),position:{x:null!=(s=e.x)?s:0,y:null!=(r=e.y)?r:0},bounds:g[e.id],children:(0,a.jsx)("div",{className:"absolute",ref:c,style:{zIndex:e.zIndex,width:e.width||H,height:e.height||400},onMouseUp:()=>b(e.id,c.current),onMouseDown:()=>i(e.id),children:(0,a.jsx)(Y,{widget:e,removeWidget:t,updateEntity:n,bringToFront:i,toggleMinimizeWidget:l,toggleFavoriteWidget:o})})},e.id)})})}var Q=t(1133),ee=t(3989),es=t(3497),et=t(4733),ea=t(7057),er=t(1021),en=t(9119),ei=t(8763),el=t(7223),eo=t(4601),ec=t(8176);let ed=ec.bL,em=ec.l9;ec.Mz;let eu=r.forwardRef((e,s)=>{let{className:t,align:r="center",sideOffset:n=4,side:i,...l}=e;return(0,a.jsx)(ec.ZL,{children:(0,a.jsx)(ec.UC,{ref:s,align:r,sideOffset:n,side:i,className:(0,A.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...l})})});eu.displayName=ec.UC.displayName;var ep=t(7481);let eh=[{name:"Incidents",query:"@incident",description:"View and manage incidents",icon:Q.A},{name:"Changes",query:"@change",description:"View and manage change requests",icon:ee.A},{name:"Problems",query:"@problem",description:"View and manage problems",icon:es.A},{name:"Overview Summary",query:"@summary",description:"Get a summary of all open widgets",icon:et.A},{name:"Fetch ServiceNow",query:"@servicenow",description:"Fetch data from ServiceNow",icon:ea.A}],ex=[{name:"Create workspace",action:"create",description:"Save the current layout as a new workspace",icon:er.A},{name:"Save workspace",action:"save",description:"Save changes to the current workspace",icon:en.A},{name:"Edit workspace",action:"edit",description:"Update or rename the current workspace",icon:ei.A},{name:"Forget workspace",action:"forget",description:"Clear the saved workspace from memory",icon:el.A}];function ef(e){let{onSubmit:s,onSave:t,loading:n,widgets:i,onWorkspaceAction:l}=e,[o,c]=(0,r.useState)(""),[d,m]=(0,r.useState)(0),[u,p]=(0,r.useState)(!1),h=(0,r.useRef)(null),{toast:x}=(0,ep.dj)(),[g,v]=(0,r.useState)(!1),[j,y]=(0,r.useState)(!1),w=(0,r.useRef)(null),[N,b]=(0,r.useState)(".");(0,r.useEffect)(()=>{let e;return n?e=setInterval(()=>{b(e=>e.length>=3?".":e+".")},500):b("."),()=>clearInterval(e)},[n]),(0,r.useEffect)(()=>{if(!("SpeechRecognition"in window||"webkitSpeechRecognition"in window))return void console.warn("Speech recognition not supported in this browser.");let e=new(window.SpeechRecognition||window.webkitSpeechRecognition);e.continuous=!1,e.lang="en-US",e.interimResults=!1,e.maxAlternatives=1,e.onresult=e=>{c(e.results[0][0].transcript),p(!1)},e.onerror=e=>{console.error("Speech recognition error:",e.error),x({variant:"destructive",title:"Voice Error",description:"Could not start voice recognition."}),p(!1)},e.onend=()=>{p(!1)},h.current=e},[x]);let k=e=>{c(e),v(!1),s(e),c(""),m(0)},C=e=>{var s;l(e),y(!1),null==(s=w.current)||s.focus()},S=0===i.length;return(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("form",{onSubmit:e=>{e.preventDefault(),o.trim()&&!n&&(s(o),c(""),m(0),v(!1))},className:"relative w-full",children:(0,a.jsxs)(ed,{open:n,children:[(0,a.jsx)(em,{asChild:!0,children:(0,a.jsxs)("div",{children:[(0,a.jsx)(L.p,{ref:w,value:o,onChange:e=>{let s=e.target.value;c(s),m(Math.ceil(s.length/4))},placeholder:"Please type your message here",className:"w-full rounded-full h-14 pl-6 pr-16 bg-card/80 border-primary focus-visible:ring-primary/50 text-base shadow-lg",disabled:n}),(0,a.jsxs)(f.$,{type:"submit",size:"icon",disabled:n||!o.trim(),className:"absolute right-4 top-1/2 -translate-y-1/2 rounded-full h-10 w-10 bg-primary/20 hover:bg-primary/30 text-primary",children:[n?(0,a.jsx)(J.A,{className:"animate-spin"}):(0,a.jsx)(eo.A,{}),(0,a.jsx)("span",{className:"sr-only",children:"Send"})]})]})}),(0,a.jsxs)(eu,{side:"top",align:"center",className:"w-auto py-1 px-3 mb-2 text-sm text-muted-foreground",sideOffset:10,children:["Thinking",N]})]})}),(0,a.jsx)("div",{className:"flex justify-between items-center px-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)(ed,{open:g,onOpenChange:v,children:[(0,a.jsx)(em,{asChild:!0,children:(0,a.jsx)(f.$,{variant:"link",className:"text-xs text-muted-foreground self-start p-0 h-auto",children:"Use Commands"})}),(0,a.jsx)(eu,{className:"w-[400px] p-2 mb-2",align:"start",onCloseAutoFocus:e=>{var s;e.preventDefault(),null==(s=w.current)||s.focus()},children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground px-2",children:"Commands"}),eh.map(e=>{let s=e.icon,t="@summary"===e.query&&S;return(0,a.jsxs)("button",{type:"button",className:(0,A.cn)("w-full text-left p-2 rounded-md hover:bg-accent flex items-start gap-3",t&&"opacity-50 cursor-not-allowed"),onClick:()=>k(e.query),disabled:t,children:[(0,a.jsx)(s,{className:"w-8 h-8 p-1.5 bg-muted rounded-md mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:e.name}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:e.description})]})]},e.name)})]})})]}),(0,a.jsxs)(ed,{open:j,onOpenChange:y,children:[(0,a.jsx)(em,{asChild:!0,children:(0,a.jsx)(f.$,{variant:"link",className:"text-xs text-muted-foreground self-start p-0 h-auto",children:"Workspace"})}),(0,a.jsx)(eu,{className:"w-[400px] p-2 mb-2",align:"start",onCloseAutoFocus:e=>{var s;e.preventDefault(),null==(s=w.current)||s.focus()},children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground px-2",children:"Workspace Actions"}),ex.map(e=>{let s=e.icon;return(0,a.jsxs)("button",{type:"button",className:"w-full text-left p-2 rounded-md hover:bg-accent flex items-start gap-3",onClick:()=>C(e.action),children:[(0,a.jsx)(s,{className:"w-8 h-8 p-1.5 bg-muted rounded-md mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:e.name}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:e.description})]})]},e.name)})]})})]})]})})]})}let eg=(0,i.createServerReference)("00501a3d54d360ccba10d39de6e541b0ba71ad0804",i.callServer,void 0,i.findSourceMapURL,"getIncidents");var ev=t(4744);let ej=(0,i.createServerReference)("603306707f491294a2c9c4a794dc17c66b97d227e1",i.callServer,void 0,i.findSourceMapURL,"getSampleData");var ey=t(5712);let ew=(0,i.createServerReference)("40edbc1f3fee218fc4073d0393f388fd8d9aa7a8c0",i.callServer,void 0,i.findSourceMapURL,"saveWorkspace"),eN=(0,i.createServerReference)("40dbcc75e845b15f530c7e3366ee6dedb97669c6fa",i.callServer,void 0,i.findSourceMapURL,"deleteWorkspace");var eb=t(8884),ek=t(8341),eC=t(6766);let eS=(0,i.createServerReference)("60e4c4bbddc829bf829a2661eeac207f85091511fd",i.callServer,void 0,i.findSourceMapURL,"detectWorkspaceChanges");var eE=t(5057),eA=t(8382),eR=t(3971),e_=t(1995),eI=t(4502),eT=t(4472),eF=t(6126);let eL=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:s,className:(0,A.cn)("w-full caption-bottom text-sm",t),...r})})});eL.displayName="Table";let eM=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("thead",{ref:s,className:(0,A.cn)("[&_tr]:border-b",t),...r})});eM.displayName="TableHeader";let eW=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tbody",{ref:s,className:(0,A.cn)("[&_tr:last-child]:border-0",t),...r})});eW.displayName="TableBody",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tfoot",{ref:s,className:(0,A.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...r})}).displayName="TableFooter";let eD=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tr",{ref:s,className:(0,A.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...r})});eD.displayName="TableRow";let eU=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("th",{ref:s,className:(0,A.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...r})});eU.displayName="TableHead";let ez=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("td",{ref:s,className:(0,A.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...r})});ez.displayName="TableCell",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("caption",{ref:s,className:(0,A.cn)("mt-4 text-sm text-muted-foreground",t),...r})}).displayName="TableCaption";var eO=t(9409),eP=t(3896),eB=t(5074),eq=t(3129),eJ=t(1887);class e${async retryRequest(e){let s,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;for(let r=0;r<=t;r++)try{return await e()}catch(e){if(s=e,!(e instanceof TypeError&&"Failed to fetch"===e.message))throw e;r<t&&(console.log("Request failed, retrying in ".concat(a,"ms (attempt ").concat(r+1,"/").concat(t+1,")")),await new Promise(e=>setTimeout(e,a)),a*=1.5)}throw s}getWebhookUrl(e){switch(e){case"get":return"https://n8n.agenticweaver.com/webhook/bp-get-role-data";case"create_update":return"https://n8n.agenticweaver.com/webhook/bp-upsert-role";case"delete":return"https://n8n.agenticweaver.com/webhook/bp-delete-role";default:return""}}async makeRequest(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw console.error("Webhook URL not configured. Available env vars:",{get:"https://n8n.agenticweaver.com/webhook/bp-get-role-data",create_update:"https://n8n.agenticweaver.com/webhook/bp-upsert-role",delete:"https://n8n.agenticweaver.com/webhook/bp-delete-role"}),Error("Webhook URL not configured");console.log("Making request to:",e,"with options:",s);try{let t=await fetch(e,{headers:{"Content-Type":"application/json",...s.headers},...s});if(console.log("Response status:",t.status),console.log("Response headers:",Object.fromEntries(t.headers.entries())),!t.ok){let e=await t.text();throw console.error("HTTP Error ".concat(t.status,":"),e),Error("HTTP ".concat(t.status,": ").concat(e))}let a=await t.json();return console.log("JSON Response received:",a),a}catch(t){if(t instanceof TypeError&&"Failed to fetch"===t.message)throw console.error("Network error - Failed to fetch. This could be due to:"),console.error("1. Network connectivity issues"),console.error("2. CORS policy blocking the request"),console.error("3. Server is unreachable"),console.error("4. SSL/TLS certificate issues"),console.error("Request details:",{url:e,method:s.method||"GET"}),Error("Network error: Unable to reach ".concat(e,". Please check your internet connection and server status."));throw t}}getSampleRoles(){return[{id:"sample-admin",name:"Administrator",description:"Full system access with all permissions",userCount:3,permissions:["User Management","Role Management","System Settings","View Reports","Export Data","Import Data","Manage Workspaces","AI Tools Access","Admin Panel"],createdAt:new Date().toLocaleDateString("en-GB"),active:!0},{id:"sample-user",name:"Standard User",description:"Basic user with limited permissions",userCount:15,permissions:["View Reports","AI Tools Access"],createdAt:new Date().toLocaleDateString("en-GB"),active:!0},{id:"sample-manager",name:"Manager",description:"Managerial role with workspace and reporting access",userCount:7,permissions:["View Reports","Export Data","Manage Workspaces","AI Tools Access"],createdAt:new Date().toLocaleDateString("en-GB"),active:!0}]}async getRoles(){let e=this.getWebhookUrl("get");if(!e)return console.log("Webhook URL not configured, returning sample roles"),this.getSampleRoles();try{let s=await this.makeRequest(e,{method:"GET"}),t=[];if(Array.isArray(s))t=s;else if(s&&"object"==typeof s&&(t=s.roles||s.data||s.items||s.result||[],0===t.length)){let e=Object.values(s);e.length>0&&Array.isArray(e[0])&&(t=e[0])}return t.map(e=>{var s;let t=[];if("string"==typeof e.permissions)try{t=JSON.parse(e.permissions)}catch(e){t=[]}else Array.isArray(e.permissions)&&(t=e.permissions);return{id:e.id||(null==(s=e._id)?void 0:s.$oid)||e._id||String(Math.random()),name:e.name||e.roleName||"Unknown Role",description:e.description||e.desc||"",userCount:e.userCount||e.users||0,permissions:t,createdAt:e.createdAt||e.created||new Date().toLocaleDateString("en-GB"),active:"True"===e.active||!0===e.active}})}catch(e){return console.error("Error fetching roles from webhook:",e),[]}}async createRole(e){let s=this.getWebhookUrl("create_update");if(!s)return console.log("Create webhook URL not configured, returning mock role"),{id:crypto.randomUUID(),name:e.name,description:e.description,userCount:0,permissions:e.permissions,createdAt:new Date().toLocaleDateString("en-GB"),active:!0};try{let t=await this.retryRequest(async()=>{let t={id:crypto.randomUUID(),name:e.name,description:e.description,permissions:JSON.stringify(e.permissions),active:"True",userCount:0,createdAt:new Date().toLocaleDateString("en-GB")};return console.log("Creating role with payload:",t),await this.makeRequest(s,{method:"POST",body:JSON.stringify(t)})});console.log("Create role response:",t);let a=t.role||t.data||t;if(!a)throw console.error("Failed to extract role from response:",t),Error("Invalid response format: missing role data");return console.log("Successfully created role:",a),a}catch(s){return console.error("Error creating role, falling back to mock data:",s),{id:crypto.randomUUID(),name:e.name,description:e.description,userCount:0,permissions:e.permissions,createdAt:new Date().toLocaleDateString("en-GB"),active:!0}}}async updateRole(e){let s=this.getWebhookUrl("create_update");if(!s)return console.log("Update webhook URL not configured, returning mock updated role"),{id:e.id,name:e.name,description:e.description,userCount:0,permissions:e.permissions,createdAt:new Date().toLocaleDateString("en-GB"),active:!0};try{let t=await this.retryRequest(async()=>{let t={id:e.id,name:e.name,description:e.description,permissions:JSON.stringify(e.permissions),active:"True"};return console.log("Updating role with payload:",t),await this.makeRequest(s,{method:"PUT",body:JSON.stringify(t)})});console.log("Update role response:",t);let a=t.role||t.data||t;if(!a)throw console.error("Failed to extract role from response:",t),Error("Invalid response format: missing role data");return console.log("Successfully updated role:",a),a}catch(s){return console.error("Error updating role, falling back to mock data:",s),{id:e.id,name:e.name,description:e.description,userCount:0,permissions:e.permissions,createdAt:new Date().toLocaleDateString("en-GB"),active:!0}}}async deleteRole(e){let s=this.getWebhookUrl("delete");if(!s)return void console.log("Delete webhook URL not configured, mock deleting role:",e);try{await this.retryRequest(async()=>{console.log("Deleting role with ID:",e);let t=await this.makeRequest(s,{method:"DELETE",body:JSON.stringify({id:e})});return console.log("Delete role response:",t),t})}catch(e){console.error("Error deleting role, treating as successful (mock deletion):",e);return}}}let eG=async()=>{console.log("=== TESTING ALL ROLE WEBHOOKS ===");let e={get:"https://n8n.agenticweaver.com/webhook/bp-get-role-data",create_update:"https://n8n.agenticweaver.com/webhook/bp-upsert-role",delete:"https://n8n.agenticweaver.com/webhook/bp-delete-role"};if(console.log("Configured webhook URLs:",e),e.get){console.log("\n--- Testing GET roles endpoint ---");try{let s=await fetch(e.get,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("GET Response status:",s.status),console.log("GET Response headers:",Object.fromEntries(s.headers.entries())),s.ok){let e=await s.json();console.log("GET Response data:",e),console.log("Data type:",typeof e),console.log("Is Array:",Array.isArray(e)),e&&"object"==typeof e&&console.log("Data keys:",Object.keys(e))}else{let e=await s.text();console.error("GET Error response:",e)}}catch(e){console.error("GET Request failed:",e)}}else console.log("GET webhook URL not configured");if(e.create_update){console.log("\n--- Testing CREATE endpoint ---");let s={name:"Test Role",description:"Test Description",permissions:JSON.stringify(["User Management"]),active:"True",userCount:0};console.log("Test payload:",s);try{let t=await fetch(e.create_update,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("CREATE Response status:",t.status),console.log("CREATE Response headers:",Object.fromEntries(t.headers.entries())),t.ok){let e=await t.json();console.log("CREATE Response data:",e)}else{let e=await t.text();console.error("CREATE Error response:",e)}}catch(e){console.error("CREATE Request failed:",e)}}else console.log("CREATE/UPDATE webhook URL not configured");console.log("=== WEBHOOK TEST COMPLETE ===")},eZ=new e$;var eV=t(6981),eY=t(518);let eH=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eV.bL,{ref:s,className:(0,A.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...r,children:(0,a.jsx)(eV.C1,{className:(0,A.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(eY.A,{className:"h-4 w-4"})})})});eH.displayName=eV.bL.displayName;var eK=t(7655);let eX=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)(eK.bL,{ref:s,className:(0,A.cn)("relative overflow-hidden",t),...n,children:[(0,a.jsx)(eK.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(eQ,{}),(0,a.jsx)(eK.OK,{})]})});eX.displayName=eK.bL.displayName;let eQ=r.forwardRef((e,s)=>{let{className:t,orientation:r="vertical",...n}=e;return(0,a.jsx)(eK.VM,{ref:s,orientation:r,className:(0,A.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...n,children:(0,a.jsx)(eK.lr,{className:"relative flex-1 rounded-full bg-border"})})});eQ.displayName=eK.VM.displayName;var e0=t(333);function e1(){let[e,s]=(0,r.useState)([]),[t,n]=(0,r.useState)([]),[i,l]=(0,r.useState)(!0),[o,c]=(0,r.useState)(""),[d,m]=(0,r.useState)("All Roles"),[u,p]=(0,r.useState)(!1),[h,g]=(0,r.useState)(null),[v,j]=(0,r.useState)({first_name:"",last_name:"",email:"",roles:[],active:!0,bio:"",avatar:"",password:"",Company:""}),{toast:y}=(0,ep.dj)(),w=async()=>{l(!0);try{let[e,t]=await Promise.all([(0,ev.CF)(),eZ.getRoles()]);s(e),n(t)}catch(e){y({title:"Error",description:"Failed to fetch users or roles.",variant:"destructive"})}finally{l(!1)}};(0,r.useEffect)(()=>{w()},[]);let N=e.filter(e=>{let s="".concat(e.first_name||""," ").concat(e.last_name||"").toLowerCase().includes(o.toLowerCase())||(e.email||"").toLowerCase().includes(o.toLowerCase()),t=e.roles&&e.roles.length>0?e.roles:[],a="All Roles"===d||t.includes(d);return s&&a}),b=(0,r.useMemo)(()=>t,[t]),k=async()=>{if(!v.email)return void y({title:"Error",description:"Please provide an email for the new user.",variant:"destructive"});let e={...v,active:v.active?"true":"false"};await (0,ev.eg)(e)?(_(),p(!1),y({title:"Success",description:"User added successfully"}),w()):y({title:"Error",description:"Failed to add user.",variant:"destructive"})},C=e=>{g(e),j({first_name:e.first_name,last_name:e.last_name,email:e.email,roles:e.roles||[],userId:e.userId,active:"true"===e.active,bio:e.bio||"",avatar:e.avatar||"",password:"",Company:e.Company||""}),p(!0)},S=async()=>{if(!h)return;let t={userId:h.userId,first_name:v.first_name,last_name:v.last_name,email:v.email,roles:v.roles||[],active:v.active?"true":"false",bio:v.bio,avatar:v.avatar,Company:v.Company};v.password&&(t.password=v.password),await (0,ev.eg)(t)?(s(e.map(e=>e.userId===h.userId?{...e,...t,active:t.active}:e)),g(null),_(),p(!1),y({title:"Success",description:"User updated successfully"})):y({title:"Error",description:"Failed to update user.",variant:"destructive"})},E=t=>{s(e.filter(e=>e.userId!==t)),y({title:"Success",description:"User deleted successfully (client-side). Implement backend delete call."})},_=()=>{j({first_name:"",last_name:"",email:"",roles:[],active:!0,bio:"",avatar:"",password:"",Company:""}),g(null)},I=e=>{j(s=>{let t=s.roles?[...s.roles]:[],a=t.indexOf(e);return a>-1?t.splice(a,1):t.push(e),{...s,roles:t}})};return i?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)(J.A,{className:"h-8 w-8 animate-spin"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"User Management"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Manage user accounts and permissions"})]}),(0,a.jsxs)(f.$,{onClick:()=>p(!0),className:"bg-orange-500 hover:bg-orange-600",children:[(0,a.jsx)(eP.A,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(eB.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,a.jsx)(L.p,{placeholder:"Search users...",value:o,onChange:e=>c(e.target.value),className:"pl-10 w-64"})]}),(0,a.jsxs)(eO.l6,{value:d,onValueChange:m,children:[(0,a.jsx)(eO.bq,{className:"w-40",children:(0,a.jsx)(eO.yv,{})}),(0,a.jsxs)(eO.gC,{children:[(0,a.jsx)(eO.eb,{value:"All Roles",children:"All Roles"}),b.map(e=>(0,a.jsx)(eO.eb,{value:e.name,children:e.name},e.id))]})]})]})})}),(0,a.jsx)(x.Wu,{children:(0,a.jsxs)(eL,{children:[(0,a.jsx)(eM,{children:(0,a.jsxs)(eD,{children:[(0,a.jsx)(eU,{children:"User"}),(0,a.jsx)(eU,{children:"Role"}),(0,a.jsx)(eU,{children:"Status"}),(0,a.jsx)(eU,{children:"Last Login"}),(0,a.jsx)(eU,{children:"Actions"})]})}),(0,a.jsx)(eW,{children:N.map(e=>{var s,t;let r=e.roles&&e.roles.length>0?e.roles:["User"];return(0,a.jsxs)(eD,{children:[(0,a.jsx)(ez,{children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)(G.eu,{children:[(0,a.jsx)(G.BK,{src:e.avatar}),(0,a.jsxs)(G.q5,{children:[null==(s=e.first_name)?void 0:s.charAt(0),null==(t=e.last_name)?void 0:t.charAt(0)]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium text-blue-600",children:[e.first_name," ",e.last_name]}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:e.email})]})]})}),(0,a.jsx)(ez,{children:(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:r.map(e=>(0,a.jsx)(eF.E,{variant:"secondary",className:(0,A.cn)("font-normal","Admin"===e?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e},e))})}),(0,a.jsx)(ez,{children:(0,a.jsx)(eF.E,{variant:"default",className:(0,A.cn)("true"===e.active?"bg-green-500":"bg-gray-400"),children:"true"===e.active?"Active":"Inactive"})}),(0,a.jsx)(ez,{className:"text-gray-600",children:"Never"}),(0,a.jsx)(ez,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(f.$,{variant:"ghost",size:"sm",onClick:()=>{C(e)},className:"text-orange-600 hover:text-orange-700",children:(0,a.jsx)(eq.A,{className:"h-4 w-4"})}),(0,a.jsx)(f.$,{variant:"ghost",size:"sm",onClick:()=>E(e.userId),className:"text-red-600 hover:text-red-700",children:(0,a.jsx)(el.A,{className:"h-4 w-4"})})]})})]},e.userId)})})]})})]}),(0,a.jsx)(R.lG,{open:u,onOpenChange:e=>{e||(p(!1),_())},children:(0,a.jsxs)(R.Cf,{className:"max-w-2xl",children:[(0,a.jsxs)(R.c7,{children:[(0,a.jsx)(R.L3,{children:h?"Edit User":"Add New User"}),(0,a.jsx)(R.rr,{children:h?"Update user information and permissions.":"Create a new user account with appropriate permissions."})]}),(0,a.jsxs)("div",{className:"grid gap-4 py-4 max-h-[60vh] overflow-y-auto pr-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(eE.J,{htmlFor:"first_name",className:"text-right",children:"First Name"}),(0,a.jsx)(L.p,{id:"first_name",value:v.first_name||"",onChange:e=>j({...v,first_name:e.target.value}),className:"col-span-3",placeholder:"Enter first name"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(eE.J,{htmlFor:"last_name",className:"text-right",children:"Last Name"}),(0,a.jsx)(L.p,{id:"last_name",value:v.last_name||"",onChange:e=>j({...v,last_name:e.target.value}),className:"col-span-3",placeholder:"Enter last name"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(eE.J,{htmlFor:"email",className:"text-right",children:"Email"}),(0,a.jsx)(L.p,{id:"email",type:"email",value:v.email||"",onChange:e=>j({...v,email:e.target.value}),className:"col-span-3",placeholder:"Enter email address",disabled:!!h})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(eE.J,{htmlFor:"password",className:"text-right",children:"Password"}),(0,a.jsx)(L.p,{id:"password",type:"password",value:v.password||"",onChange:e=>j({...v,password:e.target.value}),className:"col-span-3",placeholder:h?"Enter new password (optional)":"Enter password"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(eE.J,{htmlFor:"Company",className:"text-right",children:"Company"}),(0,a.jsx)(L.p,{id:"Company",value:v.Company||"",onChange:e=>j({...v,Company:e.target.value}),className:"col-span-3",placeholder:"Enter company name"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(eE.J,{htmlFor:"avatar",className:"text-right",children:"Avatar URL"}),(0,a.jsx)(L.p,{id:"avatar",value:v.avatar||"",onChange:e=>j({...v,avatar:e.target.value}),className:"col-span-3",placeholder:"https://example.com/avatar.png"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-start gap-4",children:[(0,a.jsx)(eE.J,{htmlFor:"bio",className:"text-right pt-2",children:"Bio"}),(0,a.jsx)(M.T,{id:"bio",value:v.bio||"",onChange:e=>j({...v,bio:e.target.value}),className:"col-span-3",placeholder:"Tell us about the user",rows:3})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(eE.J,{className:"text-right",children:"Roles"}),(0,a.jsxs)(ed,{children:[(0,a.jsx)(em,{asChild:!0,children:(0,a.jsxs)(f.$,{variant:"outline",role:"combobox",className:"col-span-3 justify-between font-normal",children:[(0,a.jsx)("span",{className:"truncate",children:v.roles&&v.roles.length>0?v.roles.join(", "):"Select roles..."}),(0,a.jsx)(eJ.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(eu,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,a.jsx)(eX,{className:"h-48",children:(0,a.jsx)("div",{className:"p-2 space-y-1",children:b.map(e=>{var s;return(0,a.jsxs)("div",{className:"flex items-center space-x-2 p-2 hover:bg-accent rounded-md",children:[(0,a.jsx)(eH,{id:"role-".concat(e.id),checked:null==(s=v.roles)?void 0:s.includes(e.name),onCheckedChange:()=>I(e.name)}),(0,a.jsx)(eE.J,{htmlFor:"role-".concat(e.id),className:"font-normal flex-1 cursor-pointer",children:e.name})]},e.id)})})})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(eE.J,{htmlFor:"active",className:"text-right",children:"Active"}),(0,a.jsx)("div",{className:"col-span-3",children:(0,a.jsx)(e0.d,{id:"active",checked:v.active,onCheckedChange:e=>j({...v,active:e})})})]})]}),(0,a.jsxs)(R.Es,{children:[(0,a.jsx)(f.$,{variant:"outline",onClick:()=>{p(!1),_()},children:"Cancel"}),(0,a.jsx)(f.$,{onClick:h?S:k,className:"bg-orange-500 hover:bg-orange-600",children:h?"Update User":"Add User"})]})]})})]})}var e4=t(8046),e2=t(286);let e5=["User Management","Role Management","System Settings","View Reports","Export Data","Import Data","Manage Workspaces","AI Tools Access","Admin Panel"];function e3(){let[e,s]=(0,r.useState)([]),[t,n]=(0,r.useState)(""),[i,l]=(0,r.useState)(!1),[o,c]=(0,r.useState)(null),[d,m]=(0,r.useState)({name:"",description:"",permissions:[]}),[u,p]=(0,r.useState)(!0),[h,g]=(0,r.useState)(!1),{toast:v}=(0,ep.dj)();(0,r.useEffect)(()=>{j()},[]);let j=async()=>{try{p(!0),console.log("Fetching roles...");let e=await eZ.getRoles();console.log("Roles data received in component:",e),s(e),e.every(e=>e.id.startsWith("sample-")||e.id.startsWith("mock-"))&&e.length>0&&v({title:"Demo Mode",description:"Showing sample role data. Connect to database for live data.",variant:"default"})}catch(e){console.error("Error fetching roles:",e),v({title:"Error",description:e instanceof Error?e.message:"Failed to load roles",variant:"destructive"})}finally{p(!1)}},y=e.filter(e=>(e.name||"").toLowerCase().includes(t.toLowerCase())||(e.description||"").toLowerCase().includes(t.toLowerCase())),w=async()=>{if(!d.name)return void v({title:"Error",description:"Please provide a role name",variant:"destructive"});try{g(!0);let t=await eZ.createRole(d);s([...e,t]),m({name:"",description:"",permissions:[]}),l(!1),v({title:"Success",description:"Role created successfully"})}catch(t){console.error("Error creating role:",t);let e=t instanceof Error?t.message:"Failed to create role",s=e.includes("Network error");v({title:s?"Network Error":"Error",description:s?"Unable to reach the server. Please check your connection and try again.":e,variant:"destructive"})}finally{g(!1)}},N=e=>{c(e),m({name:e.name,description:e.description,permissions:[...e.permissions]})},b=async()=>{if(!o||!d.name)return void v({title:"Error",description:"Please provide a role name",variant:"destructive"});try{g(!0);let t=await eZ.updateRole({id:o.id,...d}),a=e.map(e=>e.id===o.id?t:e);s(a),c(null),m({name:"",description:"",permissions:[]}),v({title:"Success",description:"Role updated successfully"})}catch(t){console.error("Error updating role:",t);let e=t instanceof Error?t.message:"Failed to update role",s=e.includes("Network error");v({title:s?"Network Error":"Error",description:s?"Unable to reach the server. Please check your connection and try again.":e,variant:"destructive"})}finally{g(!1)}},k=async t=>{try{await eZ.deleteRole(t),s(e.filter(e=>e.id!==t)),v({title:"Success",description:"Role deleted successfully"})}catch(t){console.error("Error deleting role:",t);let e=t instanceof Error?t.message:"Failed to delete role",s=e.includes("Network error");v({title:s?"Network Error":"Error",description:s?"Unable to reach the server. Please check your connection and try again.":e,variant:"destructive"})}},C=(e,s)=>{s?m({...d,permissions:[...d.permissions,e]}):m({...d,permissions:d.permissions.filter(s=>s!==e)})},S=()=>{m({name:"",description:"",permissions:[]}),c(null)};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Role Management"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Manage roles and permissions"})]}),(0,a.jsxs)(f.$,{onClick:()=>l(!0),className:"bg-orange-500 hover:bg-orange-600",disabled:u,children:[(0,a.jsx)(e4.A,{className:"h-4 w-4 mr-2"}),"Add Role"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mb-6",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(eB.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,a.jsx)(L.p,{placeholder:"Search roles...",value:t,onChange:e=>n(e.target.value),className:"pl-10 w-64",disabled:u})]}),(0,a.jsxs)(f.$,{variant:"outline",onClick:j,disabled:u,children:[u?(0,a.jsx)(J.A,{className:"h-4 w-4 mr-2 animate-spin"}):null,"Refresh"]}),(0,a.jsx)(f.$,{variant:"outline",onClick:async()=>{await eG()},disabled:u,children:"Debug All Webhooks"})]}),u?(0,a.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,a.jsx)(J.A,{className:"h-8 w-8 animate-spin"}),(0,a.jsx)("span",{className:"ml-2",children:"Loading roles..."})]}):0===y.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-gray-500",children:t?"No roles found matching your search":"No roles found"}),!t&&(0,a.jsxs)(f.$,{onClick:()=>l(!0),className:"mt-4 bg-orange-500 hover:bg-orange-600",children:[(0,a.jsx)(e4.A,{className:"h-4 w-4 mr-2"}),"Create your first role"]})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(e=>(0,a.jsxs)(x.Zp,{className:"relative",children:[(0,a.jsx)(x.aR,{children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(x.ZB,{className:"text-lg",children:e.name}),(0,a.jsx)(x.BT,{className:"mt-1",children:e.description})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(f.$,{variant:"ghost",size:"sm",onClick:()=>N(e),className:"text-orange-600 hover:text-orange-700 p-1 h-auto",children:(0,a.jsx)(eq.A,{className:"h-4 w-4"})}),(0,a.jsx)(f.$,{variant:"ghost",size:"sm",onClick:()=>k(e.id),className:"text-red-600 hover:text-red-700 p-1 h-auto",children:(0,a.jsx)(el.A,{className:"h-4 w-4"})})]})]})}),(0,a.jsx)(x.Wu,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(e2.A,{className:"h-4 w-4 text-gray-500"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[e.userCount," users"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Permissions:"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-1",children:[(e.permissions||[]).map(e=>(0,a.jsx)(eF.E,{variant:"secondary",className:"text-xs bg-orange-100 text-orange-800",children:e},e)),(!e.permissions||0===e.permissions.length)&&(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"No permissions assigned"})]})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 pt-2 border-t",children:["Created ",e.createdAt]})]})})]},e.id))}),(0,a.jsx)(R.lG,{open:i||null!==o,onOpenChange:e=>{e||(l(!1),S())},children:(0,a.jsxs)(R.Cf,{className:"max-w-2xl",children:[(0,a.jsxs)(R.c7,{children:[(0,a.jsx)(R.L3,{children:o?"Edit Role":"Add New Role"}),(0,a.jsx)(R.rr,{children:o?"Update role information and permissions.":"Create a new role with specific permissions."})]}),(0,a.jsxs)("div",{className:"grid gap-6 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(eE.J,{htmlFor:"role-name",className:"text-right",children:"Role Name"}),(0,a.jsx)(L.p,{id:"role-name",value:d.name,onChange:e=>m({...d,name:e.target.value}),className:"col-span-3",placeholder:"Enter role name",disabled:h})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-start gap-4",children:[(0,a.jsx)(eE.J,{htmlFor:"role-description",className:"text-right pt-2",children:"Description"}),(0,a.jsx)(M.T,{id:"role-description",value:d.description,onChange:e=>m({...d,description:e.target.value}),className:"col-span-3",placeholder:"Enter role description",rows:3,disabled:h})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-start gap-4",children:[(0,a.jsx)(eE.J,{className:"text-right pt-2",children:"Permissions"}),(0,a.jsx)("div",{className:"col-span-3 space-y-3",children:e5.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eH,{id:e,checked:d.permissions.includes(e),onCheckedChange:s=>C(e,s),disabled:h}),(0,a.jsx)(eE.J,{htmlFor:e,className:"text-sm font-normal",children:e})]},e))})]})]}),(0,a.jsxs)(R.Es,{children:[(0,a.jsx)(f.$,{variant:"outline",onClick:()=>{l(!1),S()},disabled:h,children:"Cancel"}),(0,a.jsxs)(f.$,{onClick:o?b:w,className:"bg-orange-500 hover:bg-orange-600",disabled:h,children:[h?(0,a.jsx)(J.A,{className:"h-4 w-4 mr-2 animate-spin"}):null,o?"Update Role":"Create Role"]})]})]})})]})}var e6=t(6950),e8=t(3464);let e7=()=>{let e="https://n8n.agenticweaver.com/webhook/bp-get-company";return e||(console.warn("NEXT_PUBLIC_GET_COMPANY_WEBHOOK is not configured."),null)},e9=()=>{let e="https://n8n.agenticweaver.com/webhook/bp-create-upsert-company";return e||(console.warn("NEXT_PUBLIC_UPSERT_WEBHOOK is not configured."),null)};async function se(){let e=e7();if(!e)return[];try{let s=await e8.A.get(e,{params:{id:"all"}});if(200===s.status&&Array.isArray(s.data))return s.data.map(e=>{var s;return{...e,id:e.id||(null==(s=e._id)?void 0:s.$oid)}});if(200===s.status&&s.data&&"object"==typeof s.data){let e=s.data.data||s.data.companies||s.data.items||s.data.result;if(Array.isArray(e))return e.map(e=>{var s;return{...e,id:e.id||(null==(s=e._id)?void 0:s.$oid)}})}return console.warn("Webhook response for all companies was not in a recognized array format. Returning empty array.",s.data),[]}catch(e){return console.error("Failed to get all companies from webhook:",e),[]}}async function ss(e){var s,t;let a=e9();if(!a)return null;try{let t=await e8.A.get(a,{params:{id:e}});if(200===t.status&&t.data){let e=Array.isArray(t.data)?t.data[0]:t.data;if(e)return{...e,id:e.id||(null==(s=e._id)?void 0:s.$oid)}}return console.warn("No company found for companyId: ".concat(e)),null}catch(s){return e8.A.isAxiosError(s)?(null==(t=s.response)?void 0:t.status)===404?console.warn("Company not found (id: ".concat(e,")")):console.error("Failed to fetch company by ID ".concat(e,":"),s.message):console.error("An unexpected error occurred:",s),null}}async function st(e){let s=e9();if(!s)return console.error("Cannot update company: NEXT_PUBLIC_UPSERT_WEBHOOK is not configured."),!1;try{let t=await e8.A.post(s,e);return 200===t.status||201===t.status}catch(e){return console.error("Failed to update company via webhook:",e),!1}}function sa(e){let{onEditCompany:s}=e,[t,n]=(0,r.useState)([]),[i,l]=(0,r.useState)(!0),[o,c]=(0,r.useState)(""),{toast:d}=(0,ep.dj)(),m=async()=>{l(!0);try{let e=await se();n(e)}catch(e){d({title:"Error",description:"Failed to fetch companies.",variant:"destructive"})}finally{l(!1)}};(0,r.useEffect)(()=>{m()},[]);let u=t.filter(e=>e.company_name.toLowerCase().includes(o.toLowerCase())||e.id.toLowerCase().includes(o.toLowerCase())||e.chat_bot_name.toLowerCase().includes(o.toLowerCase())),p=e=>{null==s||s(e)},h=e=>{n(t.filter(s=>s.id!==e)),d({title:"Success",description:"Company deleted successfully (client-side). Implement backend delete call."})};return i?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)(J.A,{className:"h-8 w-8 animate-spin"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Company Management"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Manage company accounts and configurations"})]})}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(eB.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,a.jsx)(L.p,{placeholder:"Search companies...",value:o,onChange:e=>c(e.target.value),className:"pl-10 w-64"})]})})})}),(0,a.jsx)(x.Wu,{children:(0,a.jsxs)(eL,{children:[(0,a.jsx)(eM,{children:(0,a.jsxs)(eD,{children:[(0,a.jsx)(eU,{children:"Company"}),(0,a.jsx)(eU,{children:"Bot Name"}),(0,a.jsx)(eU,{children:"Users"}),(0,a.jsx)(eU,{children:"Environment"}),(0,a.jsx)(eU,{children:"LLM Config"}),(0,a.jsx)(eU,{children:"Actions"})]})}),(0,a.jsx)(eW,{children:u.map(e=>(0,a.jsxs)(eD,{children:[(0,a.jsx)(ez,{children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,a.jsx)(e6.A,{className:"h-5 w-5 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-blue-600",children:e.company_name}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["ID: ",e.id]})]})]})}),(0,a.jsx)(ez,{children:(0,a.jsx)("div",{className:"font-medium",children:e.chat_bot_name})}),(0,a.jsx)(ez,{children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("span",{className:"text-lg font-medium",children:e.user_count}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"users"})]})}),(0,a.jsx)(ez,{children:(0,a.jsx)(eF.E,{variant:e.demo_environment?"secondary":"default",className:(0,A.cn)(e.demo_environment?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.demo_environment?"Demo":"Production"})}),(0,a.jsx)(ez,{children:(0,a.jsx)(eF.E,{variant:"outline",children:e.llm_config})}),(0,a.jsx)(ez,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(f.$,{variant:"ghost",size:"sm",onClick:()=>p(e),className:"text-orange-600 hover:text-orange-700",children:(0,a.jsx)(eq.A,{className:"h-4 w-4"})}),(0,a.jsx)(f.$,{variant:"ghost",size:"sm",onClick:()=>h(e.id),className:"text-red-600 hover:text-red-700",children:(0,a.jsx)(el.A,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})]})}function sr(e){let{companyId:s,company:t,onBack:n,onSave:i}=e,[l,o]=(0,r.useState)(t||null),[c,d]=(0,r.useState)(!t&&!!s),[m,u]=(0,r.useState)(!1),{toast:p}=(0,ep.dj)();(0,r.useEffect)(()=>{(async()=>{if(s&&!t){d(!0);try{let e=await ss(s);o(e)}catch(e){console.error("Failed to fetch company data:",e),p({variant:"destructive",title:"Error",description:"Failed to load company profile."})}finally{d(!1)}}})()},[s,t,p]);let h=(e,s)=>{l&&o({...l,[e]:s})},g=async()=>{if(l){u(!0);try{await st(l)?(p({title:"Success",description:"Company profile updated successfully!",duration:3e3}),null==i||i()):p({variant:"destructive",title:"Error",description:"Failed to update company profile."})}catch(e){console.error("Error saving company:",e),p({variant:"destructive",title:"Error",description:"An error occurred while saving."})}finally{u(!1)}}};return c?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)(J.A,{className:"h-8 w-8 animate-spin"})}):l?(0,a.jsxs)("div",{className:"space-y-6 max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[n&&(0,a.jsx)(f.$,{variant:"ghost",onClick:n,children:(0,a.jsx)(S.A,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Company Profile"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Manage company configuration and settings"})]})]}),(0,a.jsxs)(f.$,{onClick:g,disabled:m,className:"bg-orange-500 hover:bg-orange-600",children:[m?(0,a.jsx)(J.A,{className:"h-4 w-4 mr-2 animate-spin"}):(0,a.jsx)(en.A,{className:"h-4 w-4 mr-2"}),"Save Changes"]})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{children:[(0,a.jsx)(x.ZB,{children:"Profile Information"}),(0,a.jsx)(x.BT,{children:"Basic company information and configuration"})]}),(0,a.jsxs)(x.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"h-16 w-16 rounded-full bg-blue-100 flex items-center justify-center",children:(0,a.jsx)(e6.A,{className:"h-8 w-8 text-blue-600"})}),(0,a.jsxs)("div",{className:"grid gap-1.5",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:l.company_name}),(0,a.jsxs)("p",{className:"text-muted-foreground",children:["ID: ",l.id]})]})]}),(0,a.jsxs)("div",{className:"grid gap-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(eE.J,{htmlFor:"company_name",children:"Company Name"}),(0,a.jsx)(L.p,{id:"company_name",value:l.company_name,onChange:e=>h("company_name",e.target.value)})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(eE.J,{htmlFor:"id",children:"Company ID"}),(0,a.jsx)(L.p,{id:"id",value:l.id,onChange:e=>h("id",e.target.value),disabled:!0,className:"bg-gray-50"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(eE.J,{htmlFor:"chat_bot_name",children:"Chat Bot Name"}),(0,a.jsx)(L.p,{id:"chat_bot_name",value:l.chat_bot_name,onChange:e=>h("chat_bot_name",e.target.value)})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(eE.J,{htmlFor:"user_count",children:"User Count"}),(0,a.jsx)(L.p,{id:"user_count",type:"number",value:l.user_count,onChange:e=>h("user_count",parseInt(e.target.value)||0)})]})]})]})]})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{children:[(0,a.jsx)(x.ZB,{children:"Configuration"}),(0,a.jsx)(x.BT,{children:"System configuration and limits"})]}),(0,a.jsx)(x.Wu,{className:"space-y-6",children:(0,a.jsxs)("div",{className:"grid gap-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(eE.J,{htmlFor:"openai_key",children:"OpenAI API Key"}),(0,a.jsx)(L.p,{id:"openai_key",type:"password",value:l["OpenAI API Key"],onChange:e=>h("OpenAI API Key",e.target.value),placeholder:"sk-..."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(eE.J,{htmlFor:"token_allotment",children:"Token Allotment"}),(0,a.jsx)(L.p,{id:"token_allotment",type:"number",value:l.token_allotment,onChange:e=>h("token_allotment",parseInt(e.target.value)||0)})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(eE.J,{htmlFor:"max_workspace_sessions",children:"Max Workspace Sessions"}),(0,a.jsx)(L.p,{id:"max_workspace_sessions",type:"number",value:l.max_workspace_sessions,onChange:e=>h("max_workspace_sessions",parseInt(e.target.value)||0)})]})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(eE.J,{htmlFor:"llm_config",children:"LLM Configuration"}),(0,a.jsxs)(eO.l6,{value:l.llm_config,onValueChange:e=>h("llm_config",e),children:[(0,a.jsx)(eO.bq,{children:(0,a.jsx)(eO.yv,{})}),(0,a.jsxs)(eO.gC,{children:[(0,a.jsx)(eO.eb,{value:"GEMINI",children:"Gemini"}),(0,a.jsx)(eO.eb,{value:"OPENAI",children:"OpenAI"}),(0,a.jsx)(eO.eb,{value:"CLAUDE",children:"Claude"}),(0,a.jsx)(eO.eb,{value:"AZURE",children:"Azure"})]})]})]})]})})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{children:[(0,a.jsx)(x.ZB,{children:"Environment Settings"}),(0,a.jsx)(x.BT,{children:"Environment and deployment configuration"})]}),(0,a.jsx)(x.Wu,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)("div",{className:"text-base font-medium",children:"Demo Environment"}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Enable demo mode for testing and development"})]}),(0,a.jsx)(e0.d,{checked:l.demo_environment,onCheckedChange:e=>h("demo_environment",e)})]})})]})]}):(0,a.jsx)("div",{children:"Company not found. Please try again later."})}var sn=t(9509);function si(){let[e,s]=(0,r.useState)("dashboard"),[t,n]=(0,r.useState)([]),[i,p]=(0,r.useState)([]),[h,x]=(0,r.useState)([]),[v,j]=(0,r.useState)(!1),[y,w]=(0,r.useState)(!0),{toast:b}=(0,ep.dj)(),{state:k,openMobile:C,setOpenMobile:S}=(0,m.cL)(),_=(0,V.a)(),[I,T]=(0,r.useState)(1),[F,M]=(0,r.useState)({x:0,y:0}),W=(0,r.useRef)(null),D=(0,r.useRef)(null),[U,z]=(0,r.useState)(null),[O,P]=(0,r.useState)(null),[B,q]=(0,r.useState)([]),[$,G]=(0,r.useState)([]),[Z,K]=(0,r.useState)(null),[Q,ee]=(0,r.useState)(!1),[es,et]=(0,r.useState)(""),[ea,er]=(0,r.useState)(null),[ei,el]=(0,r.useState)(null),[eo,ec]=(0,r.useState)(!1),[ed,em]=(0,r.useState)(!1),eu=$.find(e=>e.workspaceId===Z)||null,eh=parseInt(sn.env.NEXT_PUBLIC_WORKSPACE_OPEN_SESSIONS||"3",10),{isChecking:ex,lastSyncTime:eF,syncNow:eL,enabled:eM}=function(e){let{user:s,workspaces:t,onWorkspacesChanged:a,onWorkspacesDeleted:n,enabled:i=!0,intervalMs:l=3e4,showNotifications:o=!0}=e,{toast:c}=(0,ep.dj)(),[d,m]=(0,r.useState)(!1),[u,p]=(0,r.useState)(null),h=(0,r.useRef)(),x=(0,r.useRef)(!0);(0,r.useEffect)(()=>{let e=()=>{x.current=!document.hidden};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[]);let f=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(s&&i&&!d&&x.current){m(!0);try{let r=await eS(s.userId,t);if(r.hasChanges){console.log("Workspace changes detected:",r);let s=[...t];if(r.deleted.length>0&&(s=s.filter(e=>!r.deleted.includes(e.workspaceId)),n(r.deleted)),r.added.length>0&&(s=[...s,...r.added]),r.modified.length>0){let e=new Map(r.modified.map(e=>[e.workspaceId,e]));s=s.map(s=>e.get(s.workspaceId)||s)}if((0,ev.qA)(s),a(s),o&&!e){let e=[];r.added.length>0&&e.push("".concat(r.added.length," workspace(s) added")),r.modified.length>0&&e.push("".concat(r.modified.length," workspace(s) updated")),r.deleted.length>0&&e.push("".concat(r.deleted.length," workspace(s) removed")),c({title:"Workspaces Updated",description:e.join(", "),duration:3e3})}}p(new Date)}catch(e){console.error("Failed to sync workspaces:",e)}finally{m(!1)}}};return(0,r.useEffect)(()=>{if(!i||!s){h.current&&(clearInterval(h.current),h.current=void 0);return}let e=setTimeout(()=>{f(!0)},2e3);return h.current=setInterval(()=>{f(!0)},l),()=>{clearTimeout(e),h.current&&clearInterval(h.current)}},[s,i,l,t.length]),(0,r.useEffect)(()=>()=>{h.current&&clearInterval(h.current)},[]),{isChecking:d,lastSyncTime:u,syncNow:()=>{f(!1)},enabled:i&&!!s}}({user:U,workspaces:B,onWorkspacesChanged:e=>{q(e)},onWorkspacesDeleted:e=>{let s=$.filter(s=>!e.includes(s.workspaceId));G(s),Z&&e.includes(Z)&&(s.length>0?(K(s[0].workspaceId),e9(s[0])):(K(null),n([])))},enabled:"false"!==sn.env.NEXT_PUBLIC_WORKSPACE_SYNC_ENABLED,intervalMs:parseInt(sn.env.NEXT_PUBLIC_WORKSPACE_SYNC_INTERVAL||"30000",10),showNotifications:"false"!==sn.env.NEXT_PUBLIC_WORKSPACE_SYNC_NOTIFICATIONS}),eW=()=>{let e=(0,ev.Ob)();if(e.user&&e.workspaces.length>=0){z(e.user),q(e.workspaces),w(!1);return}eD()},eD=async()=>{let e=localStorage.getItem("session");if(!e)return;let s=JSON.parse(e).email;if(s){j(!0);try{let e=await (0,ev.VM)(s);if(z(e),e){let s=await (0,ey.F)(e.userId);q(s)}}catch(e){console.error("Failed to fetch user data:",e)}finally{j(!1),w(!1)}}};(0,r.useEffect)(()=>{eW()},[]),((e,s,t)=>{let a=(0,r.useCallback)(e,s);(0,r.useEffect)(()=>{let e=setTimeout(()=>{a()},t);return()=>{clearTimeout(e)}},[a,t])})(()=>{!eu||!U||v||Q||ed||e6(!0)},[t,eu,U,ed],1e3);let eU=()=>{eD()},ez=e=>{s(e)},eO=e=>{P(e),s("company-edit")},eP=()=>{P(null),s("company-management")},eB=()=>{s("dashboard"),K(null),n(e=>e.map(e=>({...e,isMinimized:!0})))},eq=()=>(0,a.jsxs)("main",{className:"absolute inset-0 z-0",children:[_?(0,a.jsx)("div",{className:"p-4 space-y-4",style:{paddingTop:su,paddingBottom:sp},children:sl.map(e=>(0,a.jsx)("div",{className:"h-auto",children:(0,a.jsx)(Y,{widget:e,removeWidget:eH,updateEntity:e2,bringToFront:eG,toggleMinimizeWidget:eK,toggleFavoriteWidget:eQ})},e.id))}):(0,a.jsx)(X,{widgets:sl,removeWidget:eH,updateEntity:e2,bringToFront:eG,toggleMinimizeWidget:eK,toggleFavoriteWidget:eQ,updateWidgetPosition:e0,updateWidgetDimensions:e4,sidebarState:k,sidebarRef:W,chatInputRef:D,setIsDragging:em}),(0,a.jsx)("div",{className:"absolute inset-0 flex flex-col items-center pointer-events-none",style:{paddingLeft:!_&&W.current&&"expanded"===k?"".concat(W.current.offsetWidth,"px"):"0"},children:0===sl.length&&(0,a.jsx)("div",{className:"flex flex-col h-full w-full max-w-xl mx-auto items-center text-center p-4",style:{paddingBottom:_?sp:"6rem"},children:(0,a.jsxs)("div",{className:"flex-grow flex flex-col justify-center items-center",children:[(0,a.jsx)(eC.default,{src:"/bablephish_logo.svg",alt:"BabelPhish Logo",width:100,height:100,className:"mx-auto mb-6 opacity-50"}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-muted-foreground mb-4",children:"Welcome to BabelPhish"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-8 max-w-md",children:"Start by typing a command or query below to create your first widget."}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 w-full max-w-lg pointer-events-auto",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4 text-center col-span-full",children:"Quick browse items"}),(0,a.jsx)("div",{className:"space-y-2 col-span-full",children:sc.map((e,s)=>{let t=e.icon;return(0,a.jsxs)(f.$,{variant:"link",className:"w-full justify-start h-auto py-3 px-4 text-left text-sm bg-transparent pointer-events-auto rounded-lg",onClick:()=>sd(e.query),children:[(0,a.jsx)(t,{className:"mr-3 text-primary",size:20}),e.text]},s)})})]})]})})})]}),eJ=async function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){if(!s){let{workspaces:e}=(0,ev.Ob)();if(e.length>0){q(e),w(!1);return}}w(!0);try{let s=await (0,ey.F)(e);q(s),(0,ev.qA)(s)}catch(e){console.error("Failed to fetch workspaces",e)}finally{w(!1)}}},e$=()=>{U&&eL()};(0,r.useEffect)(()=>{eu||n([])},[eu]);let eG=(e,s)=>{n(t=>{let a=t.reduce((e,s)=>Math.max(e,s.zIndex),0)||1,r=s?100:a+1;return t.map(s=>s.id===e?{...s,zIndex:r}:s)})},eZ=(e,s)=>{var t,a,r,i;T(I+1);let l="expanded"===k&&W.current?W.current.offsetWidth:0,o=window.innerWidth-l,c=window.innerHeight,d=Math.floor(50*Math.random())-25,m=l+o/2-H/2+(Math.floor(50*Math.random())-25),u={...e,id:s||Date.now().toString(),isMinimized:!1,x:null!=(t=e.x)?t:m,y:null!=(a=e.y)?a:c/2-200+d,width:null!=(r=e.width)?r:H,height:null!=(i=e.height)?i:400};n(e=>[...e,u])},eV=async e=>{if(!e.trim())return;j(!0);let s=e.toLowerCase(),a=null;try{if(s.includes("@servicenow")){let e=await eg();a={query:"ServiceNow Records",data:e,agent:{agentType:"Incident Agent",agentBehavior:"Manages and resolves incidents."},type:"incident",isFavorited:!1}}else if(s.includes("@incident")){let e=await ej("incident");a={query:"Incidents",data:e,agent:{agentType:"Incident Agent",agentBehavior:"Manages and resolves incidents."},type:"incident",isFavorited:!1}}else if(s.includes("@change")){let e=await ej("change_request");a={query:"Changes",data:e,agent:{agentType:"Change Agent",agentBehavior:"Manages and tracks change requests."},type:"change",isFavorited:!1}}else if(s.includes("@problem")){let e=await ej("problem");a={query:"Problem",data:e,agent:{agentType:"Problem Agent",agentBehavior:"Manages and resolves problems."},type:"problem",isFavorited:!1}}else if(s.includes("@summary")){let e=t.map(e=>({type:e.type,query:e.query,data:e.data})),s=await d({widgetData:e});a={query:"Overview Summary",data:s.summary,agent:{agentType:"Summary Agent",agentBehavior:"Provides a summary of all open widgets."},type:"generic",isFavorited:!1}}else{let s=$.flatMap(e=>{try{return JSON.parse(e.workspace_data).map(e=>({type:e.type,query:e.query,data:e.data}))}catch(s){return console.error("Could not parse workspace data for ".concat(e.workspace_name),s),[]}}),t=await l({query:e,workspaceData:s});if(t.workspace_to_load){let e=B.find(e=>e.workspace_name.toLowerCase().includes(t.workspace_to_load.toLowerCase()));e?(el("load"),ss(e)):b({variant:"destructive",title:"Not Found",description:'Workspace "'.concat(t.workspace_to_load,'" not found.')})}let r=await o({widgetData:t.answer});a={query:e,data:t.answer,agent:r,type:"generic",isFavorited:!1}}if(a){let e={...a,zIndex:"generic"===a.type?100:I};eZ(e)}}catch(e){console.error("Failed to create widget:",e),b({variant:"destructive",title:"Error",description:"Could not create widget. The AI service may be temporarily unavailable. Please try again later."})}finally{j(!1)}},eY=async(e,s)=>{if(e.trim()&&s.trim())try{let t=await c({queryName:s,queryText:e});t.success?(x(t=>[...t,{name:s,query:e}]),b({title:"Query Saved",description:'"'.concat(s,'" has been saved successfully.')})):b({variant:"destructive",title:"Save Failed",description:t.message})}catch(e){console.error("Failed to save query:",e),b({variant:"destructive",title:"Error",description:"Could not save the query."})}},eH=e=>{n(s=>s.filter(s=>s.id!==e))},eK=e=>{n(s=>s.map(s=>{if(s.id===e){let e=!s.isMinimized,t={};if(!e){let e=F.x+20,s=F.y+20;M({x:e,y:s}),t={x:e,y:s}}return{...s,isMinimized:e,...t}}return s}))},eX=e=>{let s=t.find(s=>s.id===e.id);s?(s.isMinimized&&eK(s.id),eG(s.id)):eZ({...e,isFavorited:!0},e.id)},eQ=e=>{let s=t.find(s=>s.id===e);if(s||(s=i.find(s=>s.id===e)),!s)return;let a=s.isFavorited;n(s=>s.map(s=>s.id===e?{...s,isFavorited:!a}:s)),a?p(s=>s.filter(s=>s.id!==e)):p(t=>t.some(s=>s.id===e)?t.map(t=>t.id===e?{...s,isFavorited:!0}:t):[...t,{...s,isFavorited:!0}])},e0=(e,s,t)=>{n(a=>a.map(a=>a.id===e?{...a,x:s,y:t}:a))},e4=(e,s,t)=>{n(a=>a.map(a=>a.id===e?{...a,width:s,height:t}:a))},e2=(e,s,t)=>{let a=e=>e.map(e=>e.number===s?{...e,...t}:e);n(s=>s.map(s=>s.id===e&&("problem"===s.type||"incident"===s.type||"change"===s.type)?Array.isArray(s.data)?{...s,data:a(s.data)}:s:s)),p(s=>s.map(s=>s.id===e&&("problem"===s.type||"incident"===s.type||"change"===s.type)?Array.isArray(s.data)?{...s,data:a(s.data)}:s:s))},e5=e=>{el(e),"create"===e?(et(""),er(null),ee(!0)):"edit"===e?(U&&eJ(U.userId,!0),ec(!0)):"forget"===e?e7():"load"===e?(U&&eJ(U.userId),ec(!0)):"save"===e&&e6()},e6=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!eu){e||e5("create");return}if(!U)return;let s=t.map(e=>{let{x:s,y:t,width:a,height:r,zIndex:n,...i}=e;return i}),a=t.map(e=>{let{id:s,x:t,y:a,width:r,height:n,zIndex:i}=e;return{id:s,x:Math.round(t||0),y:Math.round(a||0),width:r||H,height:n||400,zIndex:i}}),r=JSON.stringify(s),n=JSON.stringify(a);if(await ew({userId:U.userId,workspace_name:eu.workspace_name,workspace_data:r,cordinates:n,workspaceId:eu.workspaceId})){if(e||b({title:"Success",description:'Workspace "'.concat(eu.workspace_name,'" saved.'),duration:2e3}),U){await eJ(U.userId,!0);let e=B.find(e=>e.workspaceId===eu.workspaceId);e&&e9(e)}}else e||b({variant:"destructive",title:"Error",description:"Failed to save workspace."})},e8=async()=>{let e,s;if(!U||!es.trim())return void b({variant:"destructive",title:"Error",description:"User not found or workspace name is empty."});j(!0);let a="create"===ei,r="edit"===ei&&ea;if(a){let a=t.map(e=>{let{x:s,y:t,width:a,height:r,zIndex:n,...i}=e;return i}),r=t.map(e=>{let{id:s,x:t,y:a,width:r,height:n,zIndex:i}=e;return{id:s,x:Math.round(t||0),y:Math.round(a||0),width:r||H,height:n||400,zIndex:i}});e=JSON.stringify(a),s=JSON.stringify(r)}else if(r)e=ea.workspace_data,s=ea.cordinates;else{let a=t.map(e=>{let{x:s,y:t,width:a,height:r,zIndex:n,...i}=e;return i}),r=t.map(e=>{let{id:s,x:t,y:a,width:r,height:n,zIndex:i}=e;return{id:s,x:Math.round(t||0),y:Math.round(a||0),width:r||H,height:n||400,zIndex:i}});e=JSON.stringify(a),s=JSON.stringify(r)}let n=a?void 0:ea.workspaceId,i=await ew({userId:U.userId,workspace_name:es,workspace_data:e,cordinates:s,workspaceId:n});if(j(!1),i)if(b({title:"Success",description:'Workspace "'.concat(es,'" saved.'),duration:2e3}),await eJ(U.userId,!0),a){let e={...i,last_accessed:new Date().toISOString()};G(s=>[...s,e]),K(e.workspaceId)}else r&&G(e=>e.map(e=>e.workspaceId===ea.workspaceId?{...e,workspace_name:es}:e));else b({variant:"destructive",title:"Error",description:"Failed to save workspace."});ee(!1),et(""),er(null)},e7=async()=>{if(!eu)return void b({variant:"destructive",title:"Error",description:"No active workspace to forget."});j(!0);let e=await eN(eu.workspaceId);if(j(!1),e){let e=eu.workspaceId;q(s=>s.filter(s=>s.workspaceId!==e)),si(e),b({title:"Success",description:'Workspace "'.concat(eu.workspace_name,'" has been forgotten.'),duration:2e3})}else b({variant:"destructive",title:"Error",description:"Failed to forget workspace."})},e9=e=>{try{if(e.workspace_data&&""!==e.workspace_data.trim()){let s=JSON.parse(e.workspace_data);if(e.cordinates){let t=JSON.parse(e.cordinates),a=new Map(t.map(e=>[e.id,e])),r=s.map(e=>({...e,...a.get(e.id)||{}}));n(r)}else n(s)}else n([])}catch(e){console.error("Failed to parse workspace data",e),b({variant:"destructive",title:"Error",description:"Could not load workspace."})}},se=e=>{if(s("dashboard"),$.find(s=>s.workspaceId===e.workspaceId)){K(e.workspaceId),e9(e);return}if($.length>=eh)return void b({variant:"destructive",title:"Limit Reached",description:"You can only have ".concat(eh," workspaces open at a time.")});G(s=>[...s,e]),K(e.workspaceId),e9(e)},ss=e=>{if(ec(!1),"load"===ei){if($.find(s=>s.workspaceId===e.workspaceId)){K(e.workspaceId),e9(e);return}if($.length>=eh)return void b({variant:"destructive",title:"Limit Reached",description:"You can only have ".concat(eh," workspaces open at a time.")});G(s=>[...s,e]),K(e.workspaceId),e9(e)}else"edit"===ei&&(er(e),et(e.workspace_name),ee(!0))},st=e=>{let s=$.find(s=>s.workspaceId===e);s&&(K(e),e9(s))},si=e=>{let s=$.filter(s=>s.workspaceId!==e);if(G(s),Z===e)if(s.length>0){let e=s[0];K(e.workspaceId),e9(e)}else K(null),n([])},sl=t.filter(e=>!e.isMinimized),so=t.filter(e=>e.isMinimized&&!i.some(s=>s.id===e.id)),sc=[{text:"Get my incidents",query:"@incident",icon:eb.A},{text:"Show me high priority changes",query:"@change high priority",icon:eb.A},{text:"Are there any recurring problems?",query:"@problem recurring",icon:eb.A}],sd=e=>{eV(e)},sm=()=>(0,a.jsx)(u.G,{user:U,minimizedWidgets:so,favoritedWidgets:i,onRestoreWidget:eK,onRestoreFavorite:eX,onProfileUpdate:eU,workspaces:B,onLoadWorkspace:se,onWorkspaceAction:e5,currentView:e,onViewChange:ez,onMainWorkspace:eB,onRefreshWorkspaces:e$,isSyncingWorkspaces:ex,syncEnabled:eM,lastSyncTime:eF,activeWorkspaceId:Z}),su=56,sp=96;return(0,a.jsxs)("div",{className:"relative flex h-screen w-screen overflow-hidden bg-background",children:[_?(0,a.jsx)(eA.cj,{open:C,onOpenChange:S,children:(0,a.jsxs)(eA.h,{side:"left",className:"p-0 w-[300px] bg-card/95",children:[(0,a.jsxs)(eA.Fm,{children:[(0,a.jsx)(eA.qp,{className:"sr-only",children:"Main Menu"}),(0,a.jsx)(eA.Qs,{className:"sr-only",children:"Navigate through workspaces, favorites, and settings."})]}),sm()]})}):(0,a.jsx)("div",{ref:W,className:"z-50",children:(0,a.jsx)(m.Bx,{side:"left",collapsible:"icon",variant:"collapsed"===k?"floating":"sidebar",children:sm()})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden relative",children:[(()=>{switch(e){case"dashboard":default:return eq();case"ai-store":return(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsx)(eI.c,{})});case"prompt-catalog":return(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsx)(eT.S,{})});case"profile":return(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsx)(eR.W,{user:U,onProfileUpdate:eU,isPage:!0})})});case"settings":return(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsx)(e_.w,{isPage:!0})})});case"user-management":return(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,a.jsx)(e1,{})})});case"role-management":return(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,a.jsx)(e3,{})})});case"company-management":return(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,a.jsx)(sa,{onEditCompany:eO})})});case"company-edit":return(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsx)(sr,{company:O,onBack:eP,onSave:eP})})}})(),_?(0,a.jsxs)("header",{className:"absolute top-0 left-0 right-0 p-2 flex items-center justify-between z-30",style:{height:su},children:[(0,a.jsx)(f.$,{variant:"ghost",size:"icon",onClick:()=>S(!0),children:(0,a.jsx)(ek.A,{})}),eu&&(0,a.jsx)("div",{className:"text-sm font-semibold truncate px-2",children:eu.workspace_name}),(0,a.jsx)("div",{className:"w-10"})]}):"dashboard"===e&&(0,a.jsx)("div",{className:"absolute top-0 left-0 right-0 flex items-center justify-center gap-2 p-4 bg-transparent z-30 pointer-events-none",children:(0,a.jsx)("div",{className:"flex items-center justify-center gap-2 pointer-events-auto",children:$.map(e=>(0,a.jsx)(g.Bc,{children:(0,a.jsxs)("div",{className:"group relative flex flex-col items-center",children:[(0,a.jsx)(f.$,{variant:e.workspaceId===Z?"secondary":"ghost",size:"sm",className:"rounded-full px-6 py-2 h-auto shadow-lg",onClick:()=>st(e.workspaceId),children:e.workspace_name}),(0,a.jsxs)("div",{className:"flex items-center justify-end w-full gap-1 mt-2 h-6 opacity-0 group-hover:opacity-100 transition-opacity pr-2",children:[(0,a.jsxs)(g.m_,{children:[(0,a.jsx)(g.k$,{asChild:!0,children:(0,a.jsx)(f.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>e6(),children:(0,a.jsx)(en.A,{size:14})})}),(0,a.jsx)(g.ZI,{children:"Save"})]}),(0,a.jsxs)(g.m_,{children:[(0,a.jsx)(g.k$,{asChild:!0,children:(0,a.jsx)(f.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{el("edit"),er(e),et(e.workspace_name),ee(!0)},children:(0,a.jsx)(E.A,{size:14})})}),(0,a.jsx)(g.ZI,{children:"Edit"})]}),(0,a.jsxs)(g.m_,{children:[(0,a.jsx)(g.k$,{asChild:!0,children:(0,a.jsx)(f.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>si(e.workspaceId),children:(0,a.jsx)(N.A,{size:14})})}),(0,a.jsx)(g.ZI,{children:"Close"})]})]})]})},e.workspaceId))})}),"dashboard"===e&&(0,a.jsx)("div",{ref:D,className:(0,A.cn)("z-40 transition-transform duration-300 ease-in-out absolute bottom-0 left-0 right-0"),style:{paddingLeft:!_&&W.current&&"expanded"===k?"".concat(W.current.offsetWidth,"px"):"0"},children:(0,a.jsx)("div",{className:"p-4 bg-transparent w-full max-w-xl mx-auto",children:(0,a.jsx)(ef,{onSubmit:eV,onSave:eY,loading:v,widgets:t,onWorkspaceAction:e5})})})]}),(0,a.jsx)(R.lG,{open:Q,onOpenChange:ee,children:(0,a.jsxs)(R.Cf,{size:"form",children:[(0,a.jsxs)(R.c7,{children:[(0,a.jsxs)(R.L3,{children:["create"===ei?"Create":"Edit"," Workspace"]}),(0,a.jsx)(R.rr,{children:"create"===ei?"Give your workspace a name to save the current layout.":"Renaming workspace: ".concat(null==ea?void 0:ea.workspace_name)})]}),(0,a.jsx)("div",{className:"grid gap-4 py-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(eE.J,{htmlFor:"workspace-name",className:"text-right",children:"Name"}),(0,a.jsx)(L.p,{id:"workspace-name",value:es,onChange:e=>et(e.target.value),className:"col-span-3"})]})}),(0,a.jsxs)(R.Es,{children:[(0,a.jsx)(R.HM,{asChild:!0,children:(0,a.jsx)(f.$,{variant:"outline",children:"Cancel"})}),(0,a.jsxs)(f.$,{onClick:e8,disabled:!es.trim()||v,children:[v&&(0,a.jsx)(J.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})]})}),(0,a.jsx)(R.lG,{open:eo,onOpenChange:ec,children:(0,a.jsxs)(R.Cf,{children:[(0,a.jsxs)(R.c7,{children:[(0,a.jsx)(R.L3,{children:"load"===ei?"Load Workspace":"Edit Workspace"}),(0,a.jsx)(R.rr,{children:"load"===ei?"Select a saved workspace to load it onto your dashboard.":"Select a workspace to edit its name."})]}),(0,a.jsx)("div",{className:"py-4",children:y?(0,a.jsx)(J.A,{className:"mx-auto animate-spin"}):(0,a.jsxs)("div",{className:"space-y-2",children:[B.map(e=>(0,a.jsx)(f.$,{variant:"ghost",className:"w-full justify-start",onClick:()=>ss(e),children:e.workspace_name},e.workspaceId)),0===B.length&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"No saved workspaces found."})]})})]})})]})}function sl(){let e=(0,n.useRouter)(),[s,t]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{localStorage.getItem("session")?t(!0):e.push("/")},[e]),s)?(0,a.jsx)("div",{children:(0,a.jsx)(m.GB,{defaultOpen:!0,children:(0,a.jsx)(si,{})})}):null}},333:(e,s,t)=>{"use strict";t.d(s,{d:()=>l});var a=t(5155),r=t(2115),n=t(4884),i=t(9434);let l=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(n.bL,{className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...r,ref:s,children:(0,a.jsx)(n.zi,{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});l.displayName=n.bL.displayName},1995:(e,s,t)=>{"use strict";t.d(s,{w:()=>m});var a=t(5155),r=t(2115),n=t(285),i=t(6695),l=t(5057),o=t(2346),c=t(333),d=t(9434);function m(e){let{isPage:s=!1}=e,[t,m]=(0,r.useState)(!1),[u,p]=(0,r.useState)(!0),[h,x]=(0,r.useState)(!1),f=()=>{console.log("Saving settings:",{darkMode:t,emailNotifications:u,pushNotifications:h})};return(0,a.jsxs)("div",{className:(0,d.cn)(!s&&"flex flex-col h-full"),children:[(0,a.jsxs)("div",{className:(0,d.cn)(!s&&"flex-grow space-y-6 pb-6"),children:[s&&(0,a.jsx)(()=>(0,a.jsxs)(i.aR,{children:[(0,a.jsx)(i.ZB,{children:"Settings"}),(0,a.jsx)(i.BT,{children:"Manage your account settings and set e-mail preferences."})]}),{}),(0,a.jsxs)(i.Zp,{children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsx)(i.ZB,{children:"Display"}),(0,a.jsx)(i.BT,{children:"Manage your display and theme settings."})]}),(0,a.jsx)(i.Wu,{className:"space-y-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:(0,d.cn)("transition-opacity",!t&&"opacity-50"),children:[(0,a.jsx)(l.J,{htmlFor:"dark-mode",children:"Dark Mode"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Enable dark theme for the application."})]}),(0,a.jsx)(c.d,{id:"dark-mode",checked:t,onCheckedChange:m,className:(0,d.cn)("transition-opacity",!t&&"opacity-50")})]})})]}),(0,a.jsxs)(i.Zp,{children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsx)(i.ZB,{children:"Notifications"}),(0,a.jsx)(i.BT,{children:"Manage how you receive notifications."})]}),(0,a.jsxs)(i.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:(0,d.cn)("transition-opacity",!u&&"opacity-50"),children:[(0,a.jsx)(l.J,{htmlFor:"email-notifications",children:"Email Notifications"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Receive notifications about your account via email."})]}),(0,a.jsx)(c.d,{id:"email-notifications",checked:u,onCheckedChange:p,className:(0,d.cn)("transition-opacity",!u&&"opacity-50")})]}),(0,a.jsx)(o.w,{}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:(0,d.cn)("transition-opacity",!h&&"opacity-50"),children:[(0,a.jsx)(l.J,{htmlFor:"push-notifications",children:"Push Notifications"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Receive push notifications on your devices."})]}),(0,a.jsx)(c.d,{id:"push-notifications",checked:h,onCheckedChange:x,className:(0,d.cn)("transition-opacity",!h&&"opacity-50")})]})]})]})]}),!s&&(0,a.jsxs)("div",{className:"flex-shrink-0 flex justify-end gap-2 pt-4 border-t",children:[(0,a.jsx)(n.$,{variant:"outline",children:"Cancel"}),(0,a.jsx)(n.$,{onClick:f,children:"Save Changes"})]}),s&&(0,a.jsx)("div",{className:"flex justify-end mt-6",children:(0,a.jsx)(n.$,{onClick:f,children:"Save Changes"})})]})}},4165:(e,s,t)=>{"use strict";t.d(s,{Cf:()=>x,Es:()=>g,HM:()=>u,L3:()=>v,c7:()=>f,lG:()=>c,rr:()=>j,zM:()=>d});var a=t(5155),r=t(2115),n=t(5821),i=t(5318),l=t(2085),o=t(9434);let c=n.bL,d=n.l9,m=n.ZL,u=n.bm,p=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(n.hJ,{ref:s,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r})});p.displayName=n.hJ.displayName;let h=(0,l.F)("fixed z-50 grid w-full gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",{variants:{size:{default:"max-w-lg left-[50%] top-[50%] translate-x-[-50%] translate-y-[-50%]",lg:"w-full max-w-4xl left-[50%] top-[50%] -translate-y-1/2 -translate-x-1/2",form:"max-w-md left-[50%] top-[50%] translate-x-[-50%] translate-y-[-50%]"}},defaultVariants:{size:"default"}}),x=r.forwardRef((e,s)=>{let{className:t,children:r,size:l,...c}=e;return(0,a.jsxs)(m,{children:[(0,a.jsx)(p,{}),(0,a.jsxs)(n.UC,{ref:s,className:(0,o.cn)(h({size:l}),t),...c,children:[r,(0,a.jsxs)(n.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(i.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});x.displayName=n.UC.displayName;let f=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};f.displayName="DialogHeader";let g=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};g.displayName="DialogFooter";let v=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(n.hE,{ref:s,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",t),...r})});v.displayName=n.hE.displayName;let j=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(n.VY,{ref:s,className:(0,o.cn)("text-sm text-muted-foreground",t),...r})});j.displayName=n.VY.displayName},4502:(e,s,t)=>{"use strict";t.d(s,{c:()=>N});var a=t(5155),r=t(2115),n=t(285),i=t(2523),l=t(6695),o=t(9409),c=t(9829),d=t(1603),m=t(3503),u=t(5074),p=t(7554),h=t(172),x=t(8098),f=t(9434),g=t(4477);let v=(0,g.createServerReference)("40f3481f303265bb99bb88571836c32cac5794f7d0",g.callServer,void 0,g.findSourceMapURL,"getAssistants");var j=t(7481);let y={zap:{component:(0,a.jsx)(c.A,{className:"text-green-500"}),bg:"bg-green-100"},box:{component:(0,a.jsx)(d.A,{className:"text-blue-500"}),bg:"bg-blue-100"},bot:{component:(0,a.jsx)(m.A,{className:"text-pink-500"}),bg:"bg-pink-100"},sky_box:{component:(0,a.jsx)(d.A,{className:"text-sky-500"}),bg:"bg-sky-100"}},w="ai_store_favorites";function N(){let[e,s]=(0,r.useState)([]),[t,c]=(0,r.useState)(""),[d,g]=(0,r.useState)("all"),[N,b]=(0,r.useState)(!0),[k,C]=(0,r.useState)(null),{toast:S}=(0,j.dj)(),E=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];b(!0),C(null);try{let t=await v(e),r=JSON.parse(localStorage.getItem(w)||"[]"),n=t.map(e=>{let s=y[e.icon]||{component:(0,a.jsx)(m.A,{className:"text-gray-500"}),bg:"bg-gray-100"};return{...e,isFavorited:r.includes(e.id),iconComponent:s.component,iconBg:s.bg,addedDate:e.addedDate||new Date().toISOString()}});s(n)}catch(e){C("Failed to load assistants. Please try refreshing."),console.error(e),S({variant:"destructive",title:"Error",description:"Could not fetch assistants from the server."})}finally{b(!1)}};(0,r.useEffect)(()=>{E()},[]);let A=t=>{let a=[],r=e.map(e=>e.id===t?{...e,isFavorited:!e.isFavorited}:e);s(r),a=r.filter(e=>e.isFavorited).map(e=>e.id),localStorage.setItem(w,JSON.stringify(a))},R=(0,r.useMemo)(()=>{let s=e.filter(e=>e.name.toLowerCase().includes(t.toLowerCase()));switch(d){case"name-asc":s.sort((e,s)=>e.name.localeCompare(s.name));break;case"name-desc":s.sort((e,s)=>s.name.localeCompare(e.name));break;case"favorites":s=s.filter(e=>e.isFavorited);break;case"recent":s.sort((e,s)=>new Date(s.addedDate).getTime()-new Date(e.addedDate).getTime())}return s},[e,t,d]);return(0,a.jsxs)("div",{className:"h-full flex flex-col p-6 pt-12 bg-background text-foreground",children:[(0,a.jsx)("header",{className:"mb-6",children:(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Welcome to the AI Storefront"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Each Assistant is created to help you do a specific set of tasks. Get answers to your questions, brainstorm ideas, create new content, and more!"})]})})}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,a.jsxs)(o.l6,{value:d,onValueChange:g,children:[(0,a.jsx)(o.bq,{className:"w-[180px]",children:(0,a.jsx)(o.yv,{placeholder:"Sort"})}),(0,a.jsxs)(o.gC,{children:[(0,a.jsx)(o.eb,{value:"all",children:"All"}),(0,a.jsx)(o.eb,{value:"recent",children:"Recently Added"}),(0,a.jsx)(o.eb,{value:"name-asc",children:"Name A-Z"}),(0,a.jsx)(o.eb,{value:"name-desc",children:"Name Z-A"}),(0,a.jsx)(o.eb,{value:"favorites",children:"Favorites"})]})]}),(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(u.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(i.p,{placeholder:"Search using assistant name",className:"pl-10",value:t,onChange:e=>c(e.target.value)})]}),(0,a.jsxs)(n.$,{variant:"ghost",onClick:()=>E(!0),disabled:N,children:[(0,a.jsx)(p.A,{className:(0,f.cn)("mr-2 h-4 w-4",N&&"animate-spin")}),"Refresh"]}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[R.length," assistants"]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto no-scrollbar",children:N?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(h.A,{className:"h-8 w-8 animate-spin"})}):k?(0,a.jsxs)("div",{className:"flex flex-col justify-center items-center h-full text-destructive",children:[(0,a.jsx)("p",{children:k}),(0,a.jsx)(n.$,{variant:"link",onClick:()=>E(!0),children:"Try again"})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:R.map(e=>(0,a.jsxs)(l.Zp,{className:"flex flex-col hover:shadow-lg transition-shadow",children:[(0,a.jsx)(l.aR,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center ".concat(e.iconBg),children:e.iconComponent}),(0,a.jsx)(l.ZB,{className:"text-sm font-semibold",children:e.name})]}),(0,a.jsx)(n.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>A(e.id),children:(0,a.jsx)(x.A,{className:(0,f.cn)("h-4 w-4",e.isFavorited&&"fill-primary text-primary")})})]})}),(0,a.jsx)(l.Wu,{className:"flex-1 p-4 pt-0",children:(0,a.jsx)(l.BT,{className:"text-xs",children:e.description})}),(0,a.jsx)(l.wL,{className:"p-4 pt-0",children:(0,a.jsx)("div",{className:"text-xs bg-gray-100 dark:bg-gray-800 text-muted-foreground rounded-full px-2 py-0.5",children:e.version})})]},e.id))})})]})}},5530:(e,s,t)=>{Promise.resolve().then(t.bind(t,56))},7759:(e,s,t)=>{"use strict";t.d(s,{C5:()=>g,MJ:()=>f,eI:()=>h,lR:()=>x,lV:()=>c,zB:()=>m});var a=t(5155),r=t(2115),n=t(4253),i=t(2177),l=t(9434),o=t(5057);let c=i.Op,d=r.createContext({}),m=e=>{let{...s}=e;return(0,a.jsx)(d.Provider,{value:{name:s.name},children:(0,a.jsx)(i.xI,{...s})})},u=()=>{let e=r.useContext(d),s=r.useContext(p),{getFieldState:t,formState:a}=(0,i.xW)(),n=t(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:l}=s;return{id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message"),...n}},p=r.createContext({}),h=r.forwardRef((e,s)=>{let{className:t,...n}=e,i=r.useId();return(0,a.jsx)(p.Provider,{value:{id:i},children:(0,a.jsx)("div",{ref:s,className:(0,l.cn)("space-y-2",t),...n})})});h.displayName="FormItem";let x=r.forwardRef((e,s)=>{let{className:t,...r}=e,{error:n,formItemId:i}=u();return(0,a.jsx)(o.J,{ref:s,className:(0,l.cn)(n&&"text-destructive",t),htmlFor:i,...r})});x.displayName="FormLabel";let f=r.forwardRef((e,s)=>{let{...t}=e,{error:r,formItemId:i,formDescriptionId:l,formMessageId:o}=u();return(0,a.jsx)(n.DX,{ref:s,id:i,"aria-describedby":r?"".concat(l," ").concat(o):"".concat(l),"aria-invalid":!!r,...t})});f.displayName="FormControl",r.forwardRef((e,s)=>{let{className:t,...r}=e,{formDescriptionId:n}=u();return(0,a.jsx)("p",{ref:s,id:n,className:(0,l.cn)("text-sm text-muted-foreground",t),...r})}).displayName="FormDescription";let g=r.forwardRef((e,s)=>{var t;let{className:r,children:n,...i}=e,{error:o,formMessageId:c}=u(),d=o?String(null!=(t=null==o?void 0:o.message)?t:""):n;return d?(0,a.jsx)("p",{ref:s,id:c,className:(0,l.cn)("text-sm font-medium text-destructive",r),...i,children:d}):null});g.displayName="FormMessage"}},e=>{var s=s=>e(e.s=s);e.O(0,[802,977,195,488,366,521,427,413,91,971,441,684,358],()=>s(5530)),_N_E=e.O()}]);
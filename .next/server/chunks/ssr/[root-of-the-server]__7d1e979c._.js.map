{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///S:/Development/BabelPhish/code_base/bable_web/src/services/workspaceService.ts"],"sourcesContent":["\r\n\r\n'use server';\r\n\r\nimport axios from 'axios';\r\nimport type { Workspace } from '@/lib/types';\r\n\r\nconst getWorkspaceWebhookUrl = () => {\r\n    const url = process.env.WORKSPACE_WEBHOOK_URL;\r\n    if (!url) {\r\n        throw new Error('WORKSPACE_WEBHOOK_URL is not configured in .env file.');\r\n    }\r\n    return url;\r\n};\r\n\r\nconst getUserWorkspacesWebhookUrl = () => {\r\n    const url = process.env.USER_WORKSPACE_WEBHOOK_URL;\r\n    if (!url) {\r\n        console.warn('USER_WORKSPACE_WEBHOOK_URL is not configured in .env file - workspace sync disabled');\r\n        return null;\r\n    }\r\n    return url;\r\n};\r\n\r\nexport async function getWorkspaces(userId: string): Promise<Workspace[]> {\r\n    try {\r\n        const webhookUrl = getUserWorkspacesWebhookUrl();\r\n        if (!webhookUrl) {\r\n            return []; // Gracefully return empty array if webhook URL is not configured\r\n        }\r\n        const response = await axios.get(webhookUrl, { params: { userId, workspaceId: 'all' } });\r\n        if (response.status === 200 && response.data) {\r\n            return Array.isArray(response.data) ? response.data : [response.data];\r\n        }\r\n        return [];\r\n    } catch (error: any) {\r\n        // Only log detailed errors for non-404 status codes\r\n        if (error?.response?.status !== 404) {\r\n            console.error('Failed to get workspaces:', error);\r\n        } else {\r\n            console.warn('Workspace endpoint not found (404) - using local workspace management');\r\n        }\r\n        return [];\r\n    }\r\n}\r\n\r\nexport interface WorkspaceChanges {\r\n    added: Workspace[];\r\n    deleted: string[];\r\n    modified: Workspace[];\r\n    hasChanges: boolean;\r\n}\r\n\r\nexport async function detectWorkspaceChanges(userId: string, currentWorkspaces: Workspace[]): Promise<WorkspaceChanges> {\r\n    try {\r\n        const freshWorkspaces = await getWorkspaces(userId);\r\n        \r\n        const currentMap = new Map(currentWorkspaces.map(ws => [ws.workspaceId, ws]));\r\n        const freshMap = new Map(freshWorkspaces.map(ws => [ws.workspaceId, ws]));\r\n        \r\n        const added: Workspace[] = [];\r\n        const modified: Workspace[] = [];\r\n        const deleted: string[] = [];\r\n        \r\n        // Find added and modified workspaces\r\n        for (const [id, freshWs] of freshMap) {\r\n            const currentWs = currentMap.get(id);\r\n            if (!currentWs) {\r\n                added.push(freshWs);\r\n            } else if (JSON.stringify(currentWs) !== JSON.stringify(freshWs)) {\r\n                modified.push(freshWs);\r\n            }\r\n        }\r\n        \r\n        // Find deleted workspaces\r\n        for (const [id] of currentMap) {\r\n            if (!freshMap.has(id)) {\r\n                deleted.push(id);\r\n            }\r\n        }\r\n        \r\n        return {\r\n            added,\r\n            deleted,\r\n            modified,\r\n            hasChanges: added.length > 0 || deleted.length > 0 || modified.length > 0\r\n        };\r\n    } catch (error) {\r\n        console.error('Failed to detect workspace changes:', error);\r\n        return {\r\n            added: [],\r\n            deleted: [],\r\n            modified: [],\r\n            hasChanges: false\r\n        };\r\n    }\r\n}\r\n\r\n\r\nexport async function saveWorkspace(workspaceData: Omit<Workspace, 'workspaceId' | 'active'> & { workspaceId?: string }): Promise<Workspace | null> {\r\n    const webhookUrl = getWorkspaceWebhookUrl();\r\n    const workspaceId = workspaceData.workspaceId || `ws_${Date.now()}`;\r\n    const payload = {\r\n        ...workspaceData,\r\n        workspaceId: workspaceId,\r\n        active: true,\r\n    };\r\n\r\n\r\n    try {\r\n        const response = await axios.post(webhookUrl, payload, { params: { workspaceId } });\r\n        if (response.status === 200 || response.status === 201) {\r\n            // The webhook can return the saved object directly or inside a 'result' property\r\n            return response.data?.result || response.data;\r\n        }\r\n        return null;\r\n    } catch (error: any) {\r\n        if (axios.isAxiosError(error)) {\r\n            // Only log detailed errors for non-404 status codes\r\n            if (error?.response?.status !== 404) {\r\n                console.error('Failed to save workspace:', {\r\n                    message: error.message,\r\n                    status: error.response?.status,\r\n                    data: error.response?.data,\r\n                    url: webhookUrl,\r\n                    sentData: payload\r\n                });\r\n            } else {\r\n                console.warn('Workspace save endpoint not found (404) - workspace not saved to remote');\r\n            }\r\n        } else {\r\n            console.error('An unexpected error occurred during workspace save:', error);\r\n        }\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function deleteWorkspace(workspaceId: string): Promise<boolean> {\r\n    const webhookUrl = getWorkspaceWebhookUrl();\r\n    try {\r\n        const response = await axios.delete(webhookUrl, { params: { workspaceId } });\r\n        return response.status === 200 || response.status === 204;\r\n    } catch (error: any) {\r\n        // Only log detailed errors for non-404 status codes\r\n        if (error?.response?.status !== 404) {\r\n            console.error('Failed to delete workspace:', error);\r\n        } else {\r\n            console.warn('Workspace delete endpoint not found (404) - workspace not deleted from remote');\r\n        }\r\n        return false;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 271, "column": 0}, "map": {"version":3,"sources":["file:///S:/Development/BabelPhish/code_base/bable_web/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getWorkspaces as '400809f3dbc890cd1b65b747a9e4787dc80a6d40b4'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 323, "column": 0}, "map": {"version":3,"sources":["file:///S:/Development/BabelPhish/code_base/bable_web/src/app/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAoR,GACjT,kDACA","debugId":null}},
    {"offset": {"line": 337, "column": 0}, "map": {"version":3,"sources":["file:///S:/Development/BabelPhish/code_base/bable_web/src/app/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAgQ,GAC7R,8BACA","debugId":null}},
    {"offset": {"line": 351, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}